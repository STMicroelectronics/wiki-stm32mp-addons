<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TF-M Crypto Service design &mdash; Trusted Firmware-M v2.1.0-stm32mp-r1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Symmetric key algorithm based Initial Attestation" href="symmetric_initial_attest.html" />
    <link rel="prev" title="Uniform Secure Service Signature" href="tfm_uniform_secure_service_signature.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Trusted Firmware-M
              <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v2.1.0-stm32mp-r1

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Threat model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/cc3xx_partial_tag_compare_on_chacha20_poly1305.html">Advisory TFMV-6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/debug_log_vulnerability.html">Advisory TFMV-7</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/2.1.0.html">v2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/2.0.0.html">v2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.8.1.html">v1.8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.8.0.html">v1.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone300/README.html">Corstone-300 FPGA (AN547 and AN552) and FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FPGA (AN555) and FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps4/corstone315/README.html">Corstone-315 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rse/index.html">Runtime Security Engine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/armchina/index.html">ArmChina</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/armchina/mps3/alcor/README.html">Alcor FPGA (AN557)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/index.html">Cypress</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">PSoC64</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/index.html">Laird Connectivity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">BL5340</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/index.html">Nordic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">nRF5340</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">nRF9160</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nordic_nrf/nrf9161dk_nrf9161/README.html">nRF9161</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/index.html">Nuvoton</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/index.html">NXP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32h5xx/readme.html">STM32H5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2xx/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO_L552ZE_Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32h573i_dk/readme.html">STM32H573I_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp215f_dk/readme.html">stm32mp215f_dk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B_U585I_IOT02A</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/tests_build_instruction.html">Build Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M tests and applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/profiles/index.html">Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium.html"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_guide/index.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/source_structure/source_structure.html">Source Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/source_structure/platform_folder.html">Details for the /platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/source_structure/platform_ext_folder.html">Details for the /platform/ext folder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/porting_tfm_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/documenting_platform.html">Platform Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/services/index.html">Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html">Internal Trusted Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_secure_partition_addition.html">Adding a New Secure Partition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_manifest_tool_user_guide.html">Manifest Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_adac_integration_guide.html">ADAC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../booting/tfm_secure_boot.html">Secure Boot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../booting/bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../booting/secure_boot_rollback_protection.html">Rollback Protection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../booting/secure_boot_hw_key_integration.html">HW Key integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dual-cpu/index.html">Dual CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/booting_a_dual_core_system.html">Booting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">SPE - NSPE communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/mailbox_ns_agent_update.html">Mailbox update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/tfm_multi_core_access_check.html">Memory Access Check</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Secure Services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="secure_partition_runtime_library.html">Secure Partition RTL</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_psa_inter_process_communication.html">Inter-Process Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="stateless_rot_service.html">Stateless Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_uniform_secure_service_signature.html">Service Signing</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="symmetric_initial_attest.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_its_service.html">Internal Trusted Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_fwu_service.html">Firmware Update</a></li>
<li class="toctree-l3"><a class="reference internal" href="ps_key_management.html">PS Key Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../software/index.html">Software Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../software/code_sharing.html">Code Sharing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../software/hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../software/tfm_cooperative_scheduling_rules.html">Cooperative Scheduling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../software/tfm_code_generation_with_jinja2.html">Code Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../software/enum_implicit_casting.html">Implicit Typecasting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ff_isolation.html">Isolation Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_builtin_keys.html">Builtin Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_log_system_design_document.html">Logging system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_physical_attack_mitigation.html">Physical Attack Mitigation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-tests/en/latest/">TF-M Tests</a></li>
<li class="toctree-l1"><a class="reference external" href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-tools/en/latest/">TF-M Tools</a></li>
<li class="toctree-l1"><a class="reference external" href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-extras/en/latest/">TF-M Extras</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32h573i_dk/readme.html">STM32H573I_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp215f_dk/readme.html">stm32mp215f_dk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO_L552ZE_Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B_U585I_IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32h5xx/readme.html">STM32H5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2xx/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO_L552ZE_Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32h573i_dk/readme.html">STM32H573I_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp215f_dk/readme.html">stm32mp215f_dk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0/index.html">v1.7.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v2.1.0/index.html">v2.1.0</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html#branch-plans">Branch plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cube/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Design Documents</a></li>
          <li class="breadcrumb-item"><a href="index.html">Secure Services</a></li>
      <li class="breadcrumb-item active">TF-M Crypto Service design</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tf-m-crypto-service-design">
<h1><a class="toc-backref" href="#id17">TF-M Crypto Service design</a><a class="headerlink" href="#tf-m-crypto-service-design" title="Permalink to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Antonio de Angelis</p>
</dd>
<dt class="field-even">Organization</dt>
<dd class="field-even"><p>Arm Limited</p>
</dd>
<dt class="field-odd">Contact</dt>
<dd class="field-odd"><p>Antonio de Angelis &lt;<a class="reference external" href="mailto:antonio&#46;deangelis&#37;&#52;&#48;arm&#46;com">antonio<span>&#46;</span>deangelis<span>&#64;</span>arm<span>&#46;</span>com</a>&gt;</p>
</dd>
</dl>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tf-m-crypto-service-design" id="id17">TF-M Crypto Service design</a></p>
<ul>
<li><p><a class="reference internal" href="#abstract" id="id18">Abstract</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id19">Introduction</a></p></li>
<li><p><a class="reference internal" href="#components" id="id20">Components</a></p></li>
<li><p><a class="reference internal" href="#relationship-between-mbed-tls-and-the-tf-m-crypto-service" id="id21">Relationship between Mbed TLS and the TF-M Crypto service</a></p>
<ul>
<li><p><a class="reference internal" href="#tf-m-crypto-as-a-particular-configuration-of-mbed-tls" id="id22">TF-M Crypto as a particular configuration of Mbed TLS</a></p></li>
<li><p><a class="reference internal" href="#usage-of-mbed-tls-configuration-headers" id="id23">Usage of Mbed TLS configuration headers</a></p></li>
<li><p><a class="reference internal" href="#hardware-acceleration" id="id24">Hardware acceleration</a></p></li>
<li><p><a class="reference internal" href="#builtin-keys" id="id25">Builtin keys</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#service-api-description" id="id26">Service API description</a></p></li>
<li><p><a class="reference internal" href="#configuration-parameters" id="id27">Configuration parameters</a></p></li>
<li><p><a class="reference internal" href="#references" id="id28">References</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="abstract">
<h2><a class="toc-backref" href="#id18">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this heading"></a></h2>
<p>This document describes the design of the TF-M Cryptographic Secure Service
(in short, TF-M Crypto service).</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id19">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>The TF-M Crypto service provides an implementation of the PSA Certified Crypto
APIs in a PSA RoT secure partition in TF-M. It is based on the Mbed TLS
project, which provides a reference implementation of the PSA Crypto APIs as a
<cite>C</cite> software library. For more details on the PSA Crypto APIs refer to <a class="footnote-reference brackets" href="#id8" id="id1">1</a>,
while for the Mbed TLS reference software refer to <a class="footnote-reference brackets" href="#id9" id="id2">2</a> and <a class="footnote-reference brackets" href="#id10" id="id3">3</a></p>
<p>The service can be requested by other services running in the SPE, or by
applications running in the NSPE, and its aim is to provide cryptographic
primitives in a secure and efficient way, either via software or by routing the
calls to any underlying crypto hardware accelerator or secure element that the
platform might provide.</p>
</div>
<div class="section" id="components">
<h2><a class="toc-backref" href="#id20">Components</a><a class="headerlink" href="#components" title="Permalink to this heading"></a></h2>
<p>The TF-M Crypto service is implemented by a number of different firmware
components residing in the Crypto partition, which are listed below:</p>
<table class="colwidths-auto docutils align-default" id="id13">
<caption><span class="caption-number">Table 44: </span><span class="caption-text">Components table</span><a class="headerlink" href="#id13" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Component name</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Location</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client API interface</p></td>
<td><p>This module exports the PSA Crypto API to be callable from the
users, which are called also <cite>clients</cite>. They could be either
other secure partitions or Non Secure world based callers.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">interface/src/tfm_crypto_api.c</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Mbed TLS <code class="docutils literal notranslate"><span class="pre">libmbedcrypto.a</span></code></p></td>
<td><p>The Mbed TLS <code class="docutils literal notranslate"><span class="pre">libmbedcrypto.a</span></code> library is used in the
service as a cryptographic <cite>backend</cite> library which provides
the APIs to implement a PSA Crypto <cite>core</cite>, SW based crypto
primitives and wrappers for HW crypto accelerators and Secure
Elements. It exposes those through the PSA Crypto APIs</p></td>
<td><p>Needed as dependency specified by the <code class="docutils literal notranslate"><span class="pre">MBEDCRYPTO_PATH</span></code> CMake
configuration option</p></td>
</tr>
<tr class="row-even"><td><p>Init module</p></td>
<td><p>This module handles the initialisation of the service objects
during TF-M boot and provides the infrastructure to service
requests when TF-M is built for IPC or SFN model.
The dispatching mechanism of IPC requests is based on a look
up table of function pointers.
This design allows for better scalability and support of a
higher number of Secure functions with minimal overhead and
duplication of code.
This module is in charge of providing an ID of the caller of
each API in the backend, allowing to enforce key ownership
policies.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_init.c</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Alloc module</p></td>
<td><p>This module handles the allocation of contexts for multipart
operations in the Secure world. This is required because the
caller view of contexts, i.e. <cite>clients</cite>, does not contain any
sensible information but just a number handle which is then
used by the service itself to match the context to the actual
context information which will be stored securely in the TF-M
crypto partition private memory. This is enabled by setting
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_CLIENT</span></code> option on the caller side. Note
that setting this option on the client side is a hard
requirement in order for the clients to work correctly</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_alloc.c</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Service modules</p></td>
<td><p>These modules (AEAD, Asymmetric, Cipher, Hash, Key Derivation,
Key Management, MAC, Random Number Generation) represent a
thin layer which is in charge of servicing the calls from the
clients. They provide parameter sanitization and context
retrieval for multipart operations, and dispatching to the
corresponding backend library function exposed by the
underlying library.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_aead.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_asymmetric.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_cipher.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_hash.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_key_derivation.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_key_management.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_mac.c</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_rng.c</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Backend library abstraction</p></td>
<td><p>This module contains several APIs to abstract the interface
towards the backend library, which must provide the PSA Crypto
core layer, key management, SW based crypto and possibly
interfaces for HW crypto accelerators and Secure Elements</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_library.*</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Manifest</p></td>
<td><p>The manifest file is a description of the service components.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/tfm_crypto.yaml</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>CMake, Kconfig and headers</p></td>
<td><p>The CMake files are used by the TF-M CMake build system to
build the service as part of the Secure FW build. The service
is built as a static library
(<code class="docutils literal notranslate"><span class="pre">libtfm_psa_rot_partition_crypto.a</span></code>).
The service itself depends on the build of the underlying
backend library, by default the <code class="docutils literal notranslate"><span class="pre">libmbedcrypto.a</span></code> target, a
static library built by the Mbed TLS build system.
The <code class="docutils literal notranslate"><span class="pre">tfm_crypto_api.h</span></code> header contains public service APIs,
which expose each module’s interface. The header available in
the interface, <code class="docutils literal notranslate"><span class="pre">tfm_crypto_defs.h</span></code>, contains types and
definitions to build the client interface of the service, i.e.
towards other services or NS world.
Finally, the <code class="docutils literal notranslate"><span class="pre">crypto_spe.h</span></code> header is used during the
build of the Mbed TLS library, when the configuration option
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_SPM</span></code> is defined, to add a custom prefix
to the PSA API symbols so that duplication of symbol names is
avoided. The prefix used for the symbols of the library is
chosen to be <code class="docutils literal notranslate"><span class="pre">mbedcrypto__</span></code>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/CMakeLists.txt</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/Kconfig</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/Kconfig.comp</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/config_crypto_check.h</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/config_engine_buf.h</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/tfm_crypto_api.h</span></code>
<code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/crypto_spe.h</span></code>
<code class="docutils literal notranslate"><span class="pre">interface/include/tfm_crypto_defs.h</span></code></p></td>
</tr>
<tr class="row-even"><td><p>TF-M Crypto key abstraction</p></td>
<td><p>The TF-M Crypto service has its own type definition to be able
to identify a key ID with its own owner. The definition of an
owner is provided by the TF-M Firmware Framework and is out of
the scope of the service itself and the PSA Crypto APIs spec.
The underlying library in practice must provide the same
functionality, i.e handle key IDs with associated owner info.
For Mbed TLS, this is accomplished by the type
<code class="docutils literal notranslate"><span class="pre">mbedtls_svc_key_id_t</span></code> when the config option of Mbed TLS
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_KEY_ID_ENCODES_OWNER</span></code> is defined. Note
that setting this option in Mbed TLS is a hard requirement for
when the library is built on the service side, while it shall
never be set when the headers are included for client side
components (i.e. other partitions or NS interface).</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">secure_fw/partitions/crypto/tfm_crypto_key.h</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Documentation</p></td>
<td><p>The
<a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html#tfm-crypto-integration-guide-label"><span class="std std-ref">integration guide</span></a>
contains the description of the TF-M Crypto service modules
and interfaces.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">docs/integration_guide/services/tfm_crypto_integration_guide.rst</span></code></p></td>
</tr>
</tbody>
</table>
<p>The interaction between the different components is described by the
block diagram in <a class="reference internal" href="#block-diagram-label"><span class="std std-numref">Figure 12:</span></a></p>
<div class="figure align-default" id="id14">
<span id="block-diagram-label"></span><img alt="../../_images/psa_rot_crypto_service_architecture.png" src="../../_images/psa_rot_crypto_service_architecture.png" />
<p class="caption"><span class="caption-number">Figure 12: </span><span class="caption-text">Block diagram of the firmware architecture of the TF-M Crypto service. Dotted
lines between services represent isolation boundaries once runtime firmware
is initialized, i.e. TF-M init phase has completed. The diagram is simplified
and shows only the major functional blocks, for a more detailed
<code class="docutils literal notranslate"><span class="pre">libmbedcrypto.a</span></code> architecture please refer to <a class="footnote-reference brackets" href="#id10" id="id4">3</a>.</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</div>
</div>
<div class="section" id="relationship-between-mbed-tls-and-the-tf-m-crypto-service">
<h2><a class="toc-backref" href="#id21">Relationship between Mbed TLS and the TF-M Crypto service</a><a class="headerlink" href="#relationship-between-mbed-tls-and-the-tf-m-crypto-service" title="Permalink to this heading"></a></h2>
<div class="section" id="tf-m-crypto-as-a-particular-configuration-of-mbed-tls">
<h3><a class="toc-backref" href="#id22">TF-M Crypto as a particular configuration of Mbed TLS</a><a class="headerlink" href="#tf-m-crypto-as-a-particular-configuration-of-mbed-tls" title="Permalink to this heading"></a></h3>
<p>Up until <cite>TF-Mv2.0</cite>, the TF-M Crypto service used to provide its own separate
implementation of the PSA Certified Crypto APIs, i.e. it provided its own
version of the implementation defined aspects of the specifications. Starting
from <cite>TF-Mv2.1</cite>, the TF-M Crypto service fully aligns to the implementation
defined by the Mbed TLS project, i.e. its implementation defined aspects are
the same as the ones defined by Mbed TLS.</p>
<p>As a consequence, starting from <cite>TF-Mv2.1</cite> the PSA Crypto headers available
in TF-M are a copy of those distributed by the Mbed TLS project. TF-M just
uses them and won’t accept any contribution to them, as those need to be
discussed in the scope of the Mbed TLS project.</p>
<p>TF-M then represents just a configuration of the Mbed TLS reference
implementation where the TF-M Crypto APIs are provided as a remote call across
a transport channel, which might be represented by a TrustZone boundary (in
Armv8.x-M systems), by a mailbox channel in heterogeneous systems, e.g. Cortex-A
+ Cortex-M systems, by an SPM mediated interface, e.g. partition to partition
calls or, in general, through a mechanism which provides process separation
between the client and the service sides of the API.
In this context, the client must always define the Mbed TLS config option
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_CLIENT</span></code>, while the service must always have
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_SPM</span></code>, mainly to avoid symbol clashing at link time between
the library interface and the <code class="docutils literal notranslate"><span class="pre">tfm_crypto_api.c</span></code> interface. When there is a
component on the service side which is able to identify the client through an
ID, it is recommended to also define <code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_KEY_ID_ENCODES_OWNER</span></code>
option in order to provide separation in the key space.</p>
</div>
<div class="section" id="usage-of-mbed-tls-configuration-headers">
<h3><a class="toc-backref" href="#id23">Usage of Mbed TLS configuration headers</a><a class="headerlink" href="#usage-of-mbed-tls-configuration-headers" title="Permalink to this heading"></a></h3>
<p>Mbed TLS uses two different configuration headers, specified through the setting
of the <code class="docutils literal notranslate"><span class="pre">MBEDTLS_CONFIG_FILE</span></code>, i.e. Mbed TLS config, and the setting of
<code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_CONFIG_FILE</span></code>, i.e. the PSA configuration. In order to be
able to perform header inclusion for <code class="docutils literal notranslate"><span class="pre">psa/crypto.h</span></code>, the configuration files
must be visible to the compilation unit through the include hierarchy. If none of
the macros are defined, the fall back strategy is to include the default config
files available in the Mbed TLS repo, i.e. <code class="docutils literal notranslate"><span class="pre">include/mbedtls/mbedtls_config.h</span></code>
and <code class="docutils literal notranslate"><span class="pre">include/psa/crypto_config.h</span></code>, which contain a set of default values for
the macros.</p>
<p>Usage of the default header config when using the TF-M Crypto service is highly
discouraged, mainly because both on the client side and on the service side a
set of options must always be defined (or undefined), as described in the
previous section. TF-M provides example _profiles_ which show the options and
how they should be used on both client and service side of the integration. Note
that to avoid falling back to the default PSA configuration, the Mbed TLS config
file must always define the symbol <code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_CONFIG</span></code>. The symbol to
enable the Mbed TLS config <code class="docutils literal notranslate"><span class="pre">MBEDTLS_CONFIG_FILE</span></code> instead must be available to
the unit being compiled which is including <code class="docutils literal notranslate"><span class="pre">psa/crypto.h</span></code>, i.e. passed by the
build system config stage.</p>
</div>
<div class="section" id="hardware-acceleration">
<h3><a class="toc-backref" href="#id24">Hardware acceleration</a><a class="headerlink" href="#hardware-acceleration" title="Permalink to this heading"></a></h3>
<p>The TF-M Crypto partition must handle all HW related crypto tasks, if the
platform is capable of offering hardware acceleration or if a complete Secure
Element is present. The main difference between the two is that a hardware
accelerator does not store keys but just accelerates operations, while a Secure
Element is capable of storing keys and the PSA Crypto core running on the host
must interface with it to store, retrieve or use them for crypto tasks, etc.</p>
<p>There are currently two methods to interface an accelerator into the Crypto
service, and both rely on the Crypto partition fully owning the Crypto hardware,
i.e. the memory mapped IO space must be bound the Crypto partition only. Both
methods are implemented through the capability of the _backend_ library to
either:</p>
<ol class="arabic simple">
<li><p>Provide a link time mechanism to replace pure SW implementations for algorithms
with HW assisted implementations. In this case, the TF-M platform provides some
additional HW abstraction through the usage of <code class="docutils literal notranslate"><span class="pre">crypto_hw_accelerator_*()</span></code>
APIs. This is dubbed the <cite>_ALT</cite> approach and will be soon to be deprecated
potentially starting from the release of Mbed TLS 4.0</p></li>
<li><p>Provide a cleanly defined interface specification <a class="footnote-reference brackets" href="#id11" id="id5">4</a> to describe the APIs that
a driver must expose to the PSA Crypto core in order for the core to be able to
offload operations to hardware. This is the preferred method for interfacing with
HW.</p></li>
</ol>
<p>Both solutions are currently handled at build time (either compilation or linking)
by Mbed TLS. For details on how to integrate a driver please refer directly to the
documentation referenced above and to the Mbed TLS repo.</p>
</div>
<div class="section" id="builtin-keys">
<h3><a class="toc-backref" href="#id25">Builtin keys</a><a class="headerlink" href="#builtin-keys" title="Permalink to this heading"></a></h3>
<p>A particular driver using the interface described in <a class="footnote-reference brackets" href="#id11" id="id6">4</a> is the TF-M Builtin
Key Loader driver <a class="footnote-reference brackets" href="#id12" id="id7">5</a>. The goal of the driver is to make Mbed TLS aware of
<em>transparent builtin keys</em>, i.e. keys which can be read from the core (i.e. not
fully opaque keys), but that are normally bound to the platform and provisioned
in it, for which it would be more appropriate to treat them as standard
<em>transparent keys</em>. The concept of <em>transparent builtin keys</em> is not defined
in the spec so it is specifically a non standard extension added by TF-M to the
Mbed TLS implementation, which might be changed between releases until a standard
solution is adopted. TF-M patches Mbed TLS on the fly to enable such behaviour
using patches available in <code class="docutils literal notranslate"><span class="pre">lib/ext/mbedcrypto</span></code>. Implementations might disable
the <code class="docutils literal notranslate"><span class="pre">tfm_builtin_key_loader</span></code> and then must provide their own alternative storage
location for all of the TF-M required builtin keys, e.g. by having them stored in
a Secure Element with a corresponding opaque driver.</p>
</div>
</div>
<div class="section" id="service-api-description">
<h2><a class="toc-backref" href="#id26">Service API description</a><a class="headerlink" href="#service-api-description" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Alloc</span></code> and <code class="docutils literal notranslate"><span class="pre">Init</span></code> modules implement public APIs which are specific to
the TF-M Crypto service, and are available only internally to other components
of the TF-M Crypto partition. For a detailed description of the prototypes
please refer to the <code class="docutils literal notranslate"><span class="pre">tfm_crypto_api.h</span></code> header.</p>
<table class="colwidths-auto docutils align-default" id="id15">
<caption><span class="caption-number">Table 45: </span><span class="caption-text">Init and Alloc modules APIs</span><a class="headerlink" href="#id15" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Function</strong></p></th>
<th class="head"><p><strong>Module</strong></p></th>
<th class="head"><p><strong>Caller</strong></p></th>
<th class="head"><p><strong>Scope</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tfm_crypto_init()</p></td>
<td><p>Init</p></td>
<td><p>SPM</p></td>
<td><p>Called during TF-M boot for initialisation. It
does modules initialisation (it initializes the Alloc
module) and initializes the <cite>backend</cite> library. Being
the partition enabled for the SFN model, it does not
implement any IPC specific message handler, instead
it relies on the SPM being able to schedule SFN
partitions using the SFN dispatcher with little
overhead</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_crypto_sfn()</p></td>
<td><p>Init</p></td>
<td><p>SPM</p></td>
<td><p>Function to handle an SFN request or to interface
with the message handler when running in IPC model</p></td>
</tr>
<tr class="row-even"><td><p>tfm_crypto_init_alloc()</p></td>
<td><p>Alloc</p></td>
<td><p>Init</p></td>
<td><p>Called by <code class="docutils literal notranslate"><span class="pre">tfm_crypto_init()</span></code>, it initialises the
internal memory storage in the TF-M Crypto partition
that the service uses to store multipart operation
contexts as requested by clients.</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_crypto_operation_alloc()</p></td>
<td><p>Alloc</p></td>
<td><p>Service modules</p></td>
<td><p>It allocates a new operation context for a multipart
operation. It returns an handle to the allocated
context in secure memory.</p></td>
</tr>
<tr class="row-even"><td><p>tfm_crypto_operation_lookup()</p></td>
<td><p>Alloc</p></td>
<td><p>Service modules</p></td>
<td><p>It retrieves a previously allocated operation context
of a multipart operation, based on the handle given
as input.</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_crypto_operation_release()</p></td>
<td><p>Alloc</p></td>
<td><p>Service modules</p></td>
<td><p>It releases a previously allocated operation context
of a multipart operation, based on the handle given
as input.</p></td>
</tr>
<tr class="row-even"><td><p>tfm_crypto_*_interface()</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></td>
<td><p>Init</p></td>
<td><p>Interface functions called by the dispatcher to
service PSA Crypto APIs requests</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-parameters">
<h2><a class="toc-backref" href="#id27">Configuration parameters</a><a class="headerlink" href="#configuration-parameters" title="Permalink to this heading"></a></h2>
<p>The TF-M Crypto service exposes some configuration parameters to tailor
the service configuration in terms of supported functionalities and
hence FLASH/RAM size to meet the requirements of different platforms and
use cases. These parameters can be provided via CMake parameters during
the CMake configuration step and as a configuration header to allow the
configuration of the Mbed TLS library. When using Kconfig they are also
exported in the Kconfig menus.</p>
<table class="colwidths-auto docutils align-default" id="id16">
<caption><span class="caption-number">Table 46: </span><span class="caption-text">Configuration parameters table</span><a class="headerlink" href="#id16" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>CRYPTO_ENGINE_BUF_SIZE</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>Buffer used by Mbed TLS for its own allocations at runtime.
This is a buffer allocated in static memory.</p></td>
<td><p>8096 (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>CRYPTO_CONC_OPER_NUM</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>This parameter defines the maximum number of possible
concurrent operation contexts (cipher, MAC, hash and key deriv)
for multi-part operations, that can be allocated simultaneously
at any time.</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p><cite>CRYPTO_IOVEC_BUFFER_SIZE</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>This parameter applies only to IPC model builds. In IPC model,
during a Service call, input and outputs are allocated
temporarily in an internal scratch buffer whose size is
determined by this parameter.</p></td>
<td><p>5120 (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>CRYPTO_STACK_SIZE</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>Defines the stack size assigned to the crypto partition in
higher level of isolation configurations (L1 isolation has a
common stack shared by all partitions)</p></td>
<td><p>6912 (bytes)</p></td>
</tr>
<tr class="row-even"><td><p><cite>CRYPTO_NV_SEED</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>Uses the Mbed TLS Crypto NV seed feature to provide entropy in
case there is no HW acceleration providing HW entropy</p></td>
<td><p>Defined for platforms which don’t have <code class="docutils literal notranslate"><span class="pre">CRYPTO_HW_ACCELERATOR</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><cite>CRYPTO_IOVEC_BUFFER_SIZE</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>Defines the size of scratch buffers to handle input/outputs if
the Memory Mapped IOVEC feature is not enabled</p></td>
<td><p>5120 (bytes)</p></td>
</tr>
<tr class="row-even"><td><p><cite>CRYPTO_SINGLE_PART_FUNCS_DISABLED</cite></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>When enabled, only the multipart, i.e. non-integrated APIs will
be available in the service</p></td>
<td><p>Not defined (Profile default)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>CRYPTO_*_MODULE_ENABLED</cite></p></td>
<td><p>CMake build
configuration parameters</p></td>
<td><p>When enabled, the correspoding shim layer module and relative
APIs are available in the service</p></td>
<td><p>Defined (Profile default)</p></td>
</tr>
<tr class="row-even"><td><p><cite>MBEDTLS_CONFIG_FILE</cite></p></td>
<td><p>Configuration header</p></td>
<td><p>The Mbed TLS library can be configured to support different
algorithms through the usage of a configuration header file
at build time. This allows for tailoring FLASH/RAM requirements
for different platforms and use cases.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lib/ext/mbedcrypto/mbedcrypto_config/tfm_mbedcrypto_config_default.h</span></code>
(Profile default)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>MBEDTLS_PSA_CRYPTO_CONFIG_FILE</cite></p></td>
<td><p>Configuration header</p></td>
<td><p>This header file specifies which cryptographic mechanisms are
available through the PSA API when <cite>MBEDTLS_PSA_CRYPTO_CONFIG</cite>
is enabled, and is not used when <cite>MBEDTLS_PSA_CRYPTO_CONFIG</cite> is
disabled. Configuring TF-M always involves having the define
enabled.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lib/ext/mbedcrypto/mbedcrypto_config/crypto_config_default.h</span></code>
(Profile default)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id28">References</a><a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<dl class="footnote brackets">
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>PSA Certified Crypto API specifications: <a class="reference external" href="https://arm-software.github.io/psa-api/crypto/">https://arm-software.github.io/psa-api/crypto/</a></p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Using PSA - Getting started in Mbed TLS: <a class="reference external" href="https://mbed-tls.readthedocs.io/en/latest/getting_started/psa/">https://mbed-tls.readthedocs.io/en/latest/getting_started/psa/</a></p>
</dd>
<dt class="label" id="id10"><span class="brackets">3</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">Mbed</span> <span class="pre">TLS</span></code> repository which holds the reference implementation as a <cite>C</cite> software library: <a class="reference external" href="https://github.com/Mbed-TLS">https://github.com/Mbed-TLS</a></p>
</dd>
<dt class="label" id="id11"><span class="brackets">4</span><span class="fn-backref">(<a href="#id5">1</a>,<a href="#id6">2</a>)</span></dt>
<dd><p>PSA Unified Driver Interface for Cryptoprocessors: <a class="reference external" href="https://github.com/Mbed-TLS/mbedtls/blob/development/docs/proposed/psa-driver-interface.md">https://github.com/Mbed-TLS/mbedtls/blob/development/docs/proposed/psa-driver-interface.md</a></p>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id7">5</a></span></dt>
<dd><p>TF-M Builtin Key Loader driver, normally described as <a class="reference internal" href="../tfm_builtin_keys.html#tfm-builtin-keys-label"><span class="std std-ref">tfm_builtin_key_loader</span></a></p>
</dd>
</dl>
<hr class="docutils" />
<p><em>Copyright (c) 2019-2024, Arm Limited. All rights reserved.</em></p>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>