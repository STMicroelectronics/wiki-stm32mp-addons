<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cooperative Scheduling Rules &mdash; Trusted Firmware-M v2.1.0-stm32mp-r1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Code Generation With Jinja2" href="tfm_code_generation_with_jinja2.html" />
    <link rel="prev" title="Hardware Abstraction Layer" href="hardware_abstraction_layer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Trusted Firmware-M
              <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v2.1.0-stm32mp-r1

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Threat model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/cc3xx_partial_tag_compare_on_chacha20_poly1305.html">Advisory TFMV-6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/debug_log_vulnerability.html">Advisory TFMV-7</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/2.1.0.html">v2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/2.0.0.html">v2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.8.1.html">v1.8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.8.0.html">v1.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone300/README.html">Corstone-300 FPGA (AN547 and AN552) and FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FPGA (AN555) and FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps4/corstone315/README.html">Corstone-315 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rse/index.html">Runtime Security Engine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/armchina/index.html">ArmChina</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/armchina/mps3/alcor/README.html">Alcor FPGA (AN557)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/index.html">Cypress</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">PSoC64</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/index.html">Laird Connectivity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">BL5340</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/index.html">Nordic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">nRF5340</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">nRF9160</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nordic_nrf/nrf9161dk_nrf9161/README.html">nRF9161</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/index.html">Nuvoton</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/index.html">NXP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32h5xx/readme.html">STM32H5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2xx/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO_L552ZE_Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32h573i_dk/readme.html">STM32H573I_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp215f_dk/readme.html">stm32mp215f_dk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B_U585I_IOT02A</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/tests_build_instruction.html">Build Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M tests and applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/profiles/index.html">Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium.html"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_guide/index.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/source_structure/source_structure.html">Source Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/source_structure/platform_folder.html">Details for the /platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/source_structure/platform_ext_folder.html">Details for the /platform/ext folder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/porting_tfm_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/documenting_platform.html">Platform Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/services/index.html">Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html">Internal Trusted Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_secure_partition_addition.html">Adding a New Secure Partition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_manifest_tool_user_guide.html">Manifest Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_adac_integration_guide.html">ADAC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../booting/tfm_secure_boot.html">Secure Boot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../booting/bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../booting/secure_boot_rollback_protection.html">Rollback Protection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../booting/secure_boot_hw_key_integration.html">HW Key integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dual-cpu/index.html">Dual CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/booting_a_dual_core_system.html">Booting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">SPE - NSPE communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/mailbox_ns_agent_update.html">Mailbox update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dual-cpu/tfm_multi_core_access_check.html">Memory Access Check</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../services/index.html">Secure Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../services/secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/secure_partition_runtime_library.html">Secure Partition RTL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/tfm_psa_inter_process_communication.html">Inter-Process Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/stateless_rot_service.html">Stateless Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/tfm_uniform_secure_service_signature.html">Service Signing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/tfm_crypto_design.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/symmetric_initial_attest.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/tfm_its_service.html">Internal Trusted Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/tfm_fwu_service.html">Firmware Update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/ps_key_management.html">PS Key Management</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Software Design</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="code_sharing.html">Code Sharing</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Cooperative Scheduling</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_code_generation_with_jinja2.html">Code Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="enum_implicit_casting.html">Implicit Typecasting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ff_isolation.html">Isolation Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_builtin_keys.html">Builtin Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_log_system_design_document.html">Logging system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_physical_attack_mitigation.html">Physical Attack Mitigation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-tests/en/latest/">TF-M Tests</a></li>
<li class="toctree-l1"><a class="reference external" href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-tools/en/latest/">TF-M Tools</a></li>
<li class="toctree-l1"><a class="reference external" href="https://trustedfirmware-m.readthedocs.io/projects/tf-m-extras/en/latest/">TF-M Extras</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32h573i_dk/readme.html">STM32H573I_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp215f_dk/readme.html">stm32mp215f_dk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO_L552ZE_Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B_U585I_IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32h5xx/readme.html">STM32H5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2xx/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO_L552ZE_Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32h573i_dk/readme.html">STM32H573I_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E_DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp215f_dk/readme.html">stm32mp215f_dk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0/index.html">v1.7.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v2.1.0/index.html">v2.1.0</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html#branch-plans">Branch plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cube/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Design Documents</a></li>
          <li class="breadcrumb-item"><a href="index.html">Software Design Notes</a></li>
      <li class="breadcrumb-item active">Cooperative Scheduling Rules</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="cooperative-scheduling-rules">
<h1>Cooperative Scheduling Rules<a class="headerlink" href="#cooperative-scheduling-rules" title="Permalink to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Ashutosh Singh</p>
</dd>
<dt class="field-even">Organization</dt>
<dd class="field-even"><p>Arm Limited</p>
</dd>
<dt class="field-odd">Contact</dt>
<dd class="field-odd"><p>Ashutosh Singh &lt;<a class="reference external" href="mailto:ashutosh&#46;singh&#37;&#52;&#48;arm&#46;com">ashutosh<span>&#46;</span>singh<span>&#64;</span>arm<span>&#46;</span>com</a>&gt;</p>
</dd>
</dl>
<div class="section" id="tf-m-scheduler-rules">
<h2>TF-M Scheduler - Rules<a class="headerlink" href="#tf-m-scheduler-rules" title="Permalink to this heading"></a></h2>
<p>On ArmV8-M CPUs, NSPE and SPE share the same physical processing element(PE). A
TF-M enabled systems need to be able to handle asynchronous events (interrupts)
regardless of current security state of the PE, and that may lead to scheduling
decisions. This introduces significant complexity into TF-M. To keep the
integrity of (NSPE and SPE) schedulers and call paths between NSPE and SPE,
following set of rules are imposed on the TF-M scheduler design.</p>
</div>
<div class="section" id="objectives-and-requirements">
<h2>Objectives and Requirements<a class="headerlink" href="#objectives-and-requirements" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Decoupling of scheduling decisions between NSPE and SPE</p></li>
<li><p>Efficient interrupt handling by SPE as well as NSPE</p></li>
<li><p>Reduce critical sections on the secure side to not block interrupts
unnecessarily</p></li>
<li><p>Scalability to allow simplification/reduction of overheads to scale down the
design for constrained devices</p></li>
<li><p>Reduce impact on NSPE software design</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>NSPE interrupt handling implementation should be independent</p></li>
<li><p>Impact on the NSPE scheduler should be minimal</p></li>
<li><p>No assumptions should be made about NSPE’s scheduling capabilities</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="scheduler-rules-for-context-switching-between-spe-and-nspe">
<h2>Scheduler Rules for context switching between SPE and NSPE<a class="headerlink" href="#scheduler-rules-for-context-switching-between-spe-and-nspe" title="Permalink to this heading"></a></h2>
<p>To allow coherent cooperative scheduling, following set of rules are imposed on
security state changes.
The switching between SPE and NSPE can be triggered in multiple ways.</p>
<p><cite>Involuntary security state switch</cite>; when the software has no control over the
switch:</p>
<ul class="simple">
<li><p>A NSPE interrupt takes control into NSPE from SPE</p></li>
<li><p>A SPE interrupt takes control into SPE from NSPE</p></li>
</ul>
<p><cite>Voluntary security state switch</cite>; when software programmatically makes the
switch:</p>
<ul class="simple">
<li><p>A NSPE exception handler returns from NSPE to pre-empted SPE context</p></li>
<li><p>A SPE exception handler returns from SPE to pre-empted NSPE context</p></li>
<li><p>NSPE makes a function call into SPE</p></li>
<li><p>SPE returns a call from NSPE</p></li>
<li><p>SPE makes a function call into NSPE (not covered in current design)</p></li>
<li><p>NSPE returns a call from SPE (not covered in current design)</p></li>
</ul>
<p>In order to maintain the call stack integrity across NSPE and SPE, following
rules are imposed on all security state switches.</p>
<div class="section" id="rules-for-nspe-exception-handling">
<h3>Rules for NSPE Exception handling<a class="headerlink" href="#rules-for-nspe-exception-handling" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>The NSPE exception handler is allowed to trigger a NSPE context switch</strong>
<strong>(regardless of security state of the preempted context.</strong></p></li>
</ol>
<p>This is expected behaviour of any (RT)OS.</p>
<ol class="arabic simple" start="2">
<li><p><strong>The NSPE scheduler must eventually ‘restore’ the preempted (by</strong>
<strong>exception) context.</strong></p></li>
</ol>
<p>This is expected behaviour of any (RT)OS.</p>
<ol class="arabic simple" start="3">
<li><p><strong>If NSPE exception results in a NSPE context switch, SPM must be informed</strong>
<strong>of the scheduling decision; this must be done BEFORE the execution of</strong>
<strong>newly scheduled-in context.</strong></p></li>
</ol>
<p>This is to ensures integrity of the call stack when SPE is ready to return a
previous function call from NSPE.</p>
</div>
<div class="section" id="rules-for-spe-exception-handling">
<h3>Rules for SPE Exception handling<a class="headerlink" href="#rules-for-spe-exception-handling" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>All of the SPE interrupts must have higher priority than NSPE interrupts</strong></p></li>
</ol>
<p>This is rule is primarily for simplifying the SPM design.</p>
<ol class="arabic simple" start="2">
<li><p><strong>The SPE interrupt handler is allowed to trigger a SPE context switch</strong>
<strong>(regardless of security state of the pre-empted context)</strong></p></li>
</ol>
<p>If the SPE context targeted by the interrupt is not same as current SPE context,
the SPM may choose to switch the current running SPE context based on priority.</p>
<ol class="arabic simple" start="3">
<li><p><strong>SPE scheduler must treat pre-empted context as one of the SPE contexts</strong></p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>If the pre-empted SPE context is SP1, the TCB for SP1 should be used for
saving the context. i.e. the context of SP1 should be saved before
scheduling anything other secure partition.</p></li>
<li><p>If SP1 was pre-empted by a NSPE interrupt, and subsequent NSPE execution is
pre-empted by SPE exception (before NSPE scheduling decision is communicated
back to SPM) – SP1 TCB must be used for saving the context
In this case SPM is not yet aware of the NSPE context switch, from SPM’s
standpoint SP1 is still executing, so SPM assumes that the preempted context
is SP1.</p></li>
<li><p>If SP1 was pre-empted by a NSPE interrupt, and subsequent NSPE execution is
pre-empted by SPE exception <cite>after</cite> NSPE scheduling decision is
communicated back to SPM) - a TCB dedicated to NSPE should be used for
saving the context.</p></li>
</ol>
<p>When NSPE scheduler communicates the scheduling decision to SPM, SPM must save
the SP1 context, if a SPE interrupt preempts the currently running NSPE context,
SPM should save the context to a dedicated NSPE TCB.</p>
<p>d. The SPE scheduler must eventually ‘restore’ the pre-empted context.
This is an expected behaviour of any scheduler.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p><strong>All of the interrupts belonging to a partition must have same priority.</strong></p></li>
</ol>
<p>This serializes ISR execution targeted for same partition.</p>
<ol class="arabic simple" start="5">
<li><p><strong>In case of nested interrupts, all of the ISRs must run to finish before</strong>
<strong>any service code is allowed to run</strong></p></li>
</ol>
<p>This is an expected behaviour of any scheduler.</p>
<ol class="arabic simple" start="6">
<li><p><strong>If the previously preempted context was a NSPE ISR context, SPE ISR</strong>
<strong>handler must return to preempted NSPE context.</strong></p></li>
</ol>
<p>This is an expected behaviour of any scheduler to return to preempted context.</p>
</div>
<div class="section" id="rules-for-nspe-to-spm-function-call-and-nspe-scheduler">
<h3>Rules for NSPE to SPM function call (and NSPE scheduler)<a class="headerlink" href="#rules-for-nspe-to-spm-function-call-and-nspe-scheduler" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Current NSPE context must have been communicated to SPM, otherwise SPM cannot
guarantee NSPE function calling stack integrity.</p></li>
</ol>
</div>
<div class="section" id="rules-for-function-return-from-spe-to-nspe-with-result">
<h3>Rules for Function Return from SPE to NSPE with result<a class="headerlink" href="#rules-for-function-return-from-spe-to-nspe-with-result" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>The result available on SPE side are for currently active NSPE context.</strong></p></li>
</ol>
<p>To maintain call stack integrity, if SPE is ready to return to NSPE, it can do
function return only if the SPE return path corresponds to currently active NSPE
context.</p>
<ol class="arabic simple" start="2">
<li><p><strong>Last entry into secure world happened programmatically (Voluntary</strong>
<strong>security state switch into SPE)</strong></p></li>
</ol>
<p>i.e. control is voluntarily given back by NSPE, either through a function call,
or a context restore via ‘return to SPE from NSPE’. As opposed to a SPE
interrupt bringing back the execution into SPE.</p>
<ol class="arabic simple" start="3">
<li><p><strong>The current NSPE call stack has not already been returned with SPM_IDLE.</strong></p></li>
</ol>
<p>This rule applies if following optional feature is enabled.</p>
</div>
<div class="section" id="rules-for-return-from-spe-to-nspe-with-spm-idle">
<h3>Rules for Return from SPE to NSPE with SPM_IDLE<a class="headerlink" href="#rules-for-return-from-spe-to-nspe-with-spm-idle" title="Permalink to this heading"></a></h3>
<p>This is optional part of the design as it introduces significant complexity on
both sides of the security boundary.
It allows yielding of the CPU to NSPE when SPE has not CPU execution to do but
it has not yet finished the previous request(s) from NSPE; i.e. SPE is waiting
on arrival of a SPE interrupt.</p>
<ol class="arabic simple">
<li><p><strong>Last entry into secure world happens programmatically (Voluntary</strong>
<strong>security context switch into SPE)</strong></p></li>
</ol>
<p>i.e. control is voluntarily given back by NSPE, either through a function call,
or a context restore via ‘return to SPE from NSPE’. As opposed to a SPE
interrupt bringing back the execution into SPE.</p>
<ol class="arabic simple" start="2">
<li><p><strong>The result for the currently active NSPE entity is not yet available,</strong>
<strong>the called service is waiting (on interrupt/event).</strong></p></li>
</ol>
<p>SPE request corresponding to currently active NSPE caller is not yet completed
and is waiting on an ISR.</p>
<ol class="arabic simple" start="3">
<li><p><strong>The current NSPE call stack has not already been returned with SPM_IDLE.</strong></p></li>
</ol>
</div>
<div class="section" id="rules-for-nspe-pend-irq-based-return-from-spe-to-nspe">
<h3>Rules for NSPE pend irq based return from SPE to NSPE<a class="headerlink" href="#rules-for-nspe-pend-irq-based-return-from-spe-to-nspe" title="Permalink to this heading"></a></h3>
<p>This is optional part of the design as it introduces significant complexity on
both sides. This works in conjunction with [Rules for Return from SPE to NSPE
with SPM_IDLE](#rules-for-return-from-spe-to-nspe-with-spm_idle).
In this scenario, when SPE is ready with result for a previous call from NSPE,
it raises a pended IRQ to NSPE instead of returning the function call path.</p>
<ol class="arabic simple">
<li><p><strong>The SPE has finished a NSPE request.</strong></p></li>
<li><p><strong>The corresponding NSPE context has already been returned with SPM_IDLE.</strong></p></li>
</ol>
</div>
<div class="section" id="rules-for-isr-pre-emption">
<h3>Rules for ISR pre-emption<a class="headerlink" href="#rules-for-isr-pre-emption" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>A higher priority NSPE interrupt is allowed to preempt a lower priority</strong>
<strong>NSPE ISR</strong></p></li>
<li><p><strong>A higher priority SPE interrupt is allowed to preempt a lower priority</strong>
<strong>SPE ISR</strong></p></li>
<li><p><strong>A SPE interrupt is allowed to preempt NSPE ISR</strong></p></li>
<li><p><strong>A NSPE interrupt is not allowed to preempt SPE ISR</strong></p></li>
<li><p><strong>All interrupts belonging to a service must have same priority</strong></p></li>
</ol>
<hr class="docutils" />
<p><em>Copyright (c) 2019-2024, Arm Limited. All rights reserved.</em></p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>