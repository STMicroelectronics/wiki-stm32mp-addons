<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding Secure Partition &mdash; Trusted Firmware-M v1.7.0-stm32mp25-alpha-r1-rc3-doc documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TF-M Manifest Tool User Guide" href="tfm_manifest_tool_user_guide.html" />
    <link rel="prev" title="Protected Storage Service Integration Guide" href="tfm_ps_integration_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Trusted Firmware-M
            <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v1.7.0-stm32mp25-alpha-r1-rc3-doc

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/index.html">Threat Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Trusted Firmware-M Generic Threat Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.7.0.html">v1.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.1.html">v1.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.0.html">v1.6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.5.0.html">v1.5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platform Selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an547/README.html">Corstone-300 FPGA (AN547)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an552/README.html">Corstone-300 FPGA and FVP (AN552)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rss/readme.html">Runtime Security Subsystem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">Cypress PSoC64</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/cypress_psoc64_spec.html">Cypress PSoC64 Specifics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/README.html">Core Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/RELEASE.html">Core Library Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">Nordic nRF5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">Nordic nRF9160</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">Laird Connectivity BL5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/profiles/index.html">Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium.html"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Integration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../platform/platform_folder.html">Details for the platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/platform_ext_folder.html">Details for the platform/ext folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/porting_TFM_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_its_integration_guide.html">Internal Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Adding a New Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_manifest_tool_user_guide.html">The manifest tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../technical_references/design_docs/index.html">Design Documents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/index.html">Dual-CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/booting_a_dual_core_system.html">Booting a Dual-Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">Communication Prototype Between NSPE And SPE In Dual Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox Design in TF-M on Dual-core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/tfm_multi_core_access_check.html">Memory Access Check of Trusted Firmware-M in Multi-Core Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/code_sharing.html">Code sharing between independently linked XIP binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/enum_implicit_casting.html">Fixing implicit casting for C enumeration values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/ff_isolation.html">FF-M Isolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/mailbox_ns_agent_update.html">Mailbox NS Agent Design Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/ps_key_management.html">Protected Storage service key management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/secure_boot_hw_key_integration.html">HW crypto key integration in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/secure_boot_rollback_protection.html">Rollback protection in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/source_structure.html">Trusted Firmware-M Source Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/stateless_rot_service.html">Stateless Root of Trust Services Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/symmetric_initial_attest.html">Symmetric key algorithm based Initial Attestation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_builtin_keys.html">TF-M builtin keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_code_generation_with_jinja2.html">Code Generation With Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_cooperative_scheduling_rules.html">Cooperative Scheduling Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_crypto_design.html">Crypto Service design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_fwu_service.html">Firmware Update Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_its_512_flash.html">Add support for block-aligned flash in Internal Trusted Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_its_service.html">Internal Trusted Storage (ITS) Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_log_system_design_document.html">Log system design document</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_physical_attack_mitigation.html">Physical attack mitigation in Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_psa_inter_process_communication.html">TF-M Inter-Process Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_secure_boot.html">Secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_secure_partition_runtime_library.html">Secure Partition Runtime Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_uniform_secure_service_signature.html">Uniform Secure Service Signature</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/view/TF-M/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0-stm32mp25-alpha-r1-rc3/changelog.html">v1.7.0-stm32mp25-alpha-r1-rc3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cubeide/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Integration Guide</a> &raquo;</li>
          <li><a href="index.html">Services</a> &raquo;</li>
      <li>Adding Secure Partition</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-secure-partition">
<h1>Adding Secure Partition<a class="headerlink" href="#adding-secure-partition" title="Permalink to this heading"></a></h1>
<section id="terms-and-abbreviations">
<h2>Terms and abbreviations<a class="headerlink" href="#terms-and-abbreviations" title="Permalink to this heading"></a></h2>
<p>This document uses the following terms and abbreviations.</p>
<table class="colwidths-auto docutils align-default" id="id1">
<caption><span class="caption-number">Table 35: </span><span class="caption-text">term table</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Term</strong></p></th>
<th class="head"><p><strong>Meaning</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FF-M</p></td>
<td><p>Firmware Framework for M</p></td>
</tr>
<tr class="row-odd"><td><p>ID</p></td>
<td><p>Identifier</p></td>
</tr>
<tr class="row-even"><td><p>IPC</p></td>
<td><p>Interprocess communication</p></td>
</tr>
<tr class="row-odd"><td><p>IPC model</p></td>
<td><p>The secure IPC framework</p></td>
</tr>
<tr class="row-even"><td><p>irqs</p></td>
<td><p>Interrupt requests</p></td>
</tr>
<tr class="row-odd"><td><p>MMIO</p></td>
<td><p>Memory Mapped I/O</p></td>
</tr>
<tr class="row-even"><td><p>PSA</p></td>
<td><p>Platform Security Architecture</p></td>
</tr>
<tr class="row-odd"><td><p>RoT</p></td>
<td><p>Root of Trust</p></td>
</tr>
<tr class="row-even"><td><p>SFN</p></td>
<td><p>Secure Function</p></td>
</tr>
<tr class="row-odd"><td><p>SFN model</p></td>
<td><p>Secure Function model</p></td>
</tr>
<tr class="row-even"><td><p>SID</p></td>
<td><p>RoT Service ID</p></td>
</tr>
<tr class="row-odd"><td><p>SP</p></td>
<td><p>Secure Partition</p></td>
</tr>
<tr class="row-even"><td><p>SPM</p></td>
<td><p>Secure Partition Manager</p></td>
</tr>
<tr class="row-odd"><td><p>TF-M</p></td>
<td><p>Trusted firmware M</p></td>
</tr>
</tbody>
</table>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>Secure Partition is an execution environment that provides the following
functions to Root of Trust (RoT) Services:</p>
<ul class="simple">
<li><p>Access to resources, protection of its own code and data.</p></li>
<li><p>Mechanisms to interact with other components in the system.</p></li>
</ul>
<p>Each Secure Partition is a single thread of execution and the smallest unit of
isolation.</p>
<p>This document mainly describes how to add a secure partition in TF-M and
focuses on the configuration, manifest, implement rules. The actual
source-level implementation is not included in this document.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If not otherwise specified, the steps are identical for IPC and SFN model.</p>
<p>The IPC and SFN model conforms to the <em>PSA Firmware Framework for M (FF-M) v
1.1</em> changes. Refer to <a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA Firmware Framework specification</a> and
<a class="reference external" href="https://developer.arm.com/documentation/aes0039/latest">Firmware Framework for M 1.1 Extensions</a> for details.</p>
</div>
</section>
<section id="process">
<h2>Process<a class="headerlink" href="#process" title="Permalink to this heading"></a></h2>
<p>The main steps to add a secure partition are as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#add-source-folder">Add source folder</a></p></li>
<li><p><a class="reference internal" href="#add-manifest">Add manifest</a></p></li>
<li><p><a class="reference internal" href="#add-configuration">Add configuration</a></p></li>
<li><p><a class="reference internal" href="#implement-the-rot-services">Implement the RoT services</a></p></li>
</ul>
<section id="add-source-folder">
<h3>Add source folder<a class="headerlink" href="#add-source-folder" title="Permalink to this heading"></a></h3>
<p>Add a source folder under <code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/secure_fw/partitions</span></code> for the
new secure partition (Let’s take <code class="docutils literal notranslate"><span class="pre">example</span></code> as the folder name):</p>
<p>This folder should include those parts:</p>
<ul class="simple">
<li><p>Manifest file</p></li>
<li><p>CMake configuration files</p></li>
<li><p>Source code files</p></li>
</ul>
</section>
<section id="add-manifest">
<h3>Add manifest<a class="headerlink" href="#add-manifest" title="Permalink to this heading"></a></h3>
<p>Each Secure Partition must have resource requirements declared in a manifest
file. The Secure Partition Manager (SPM) uses the manifest file to assemble and
allocate resources within the SPE. The manifest includes the following:</p>
<ul class="simple">
<li><p>A Secure Partition name.</p></li>
<li><p>A list of implemented RoT Services.</p></li>
<li><p>Access to other RoT Services.</p></li>
<li><p>Memory requirements.</p></li>
<li><p>Scheduling hints.</p></li>
<li><p>Peripheral memory-mapped I/O regions and interrupts.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The current manifest format in TF-M is “yaml” which is different from the
requirement of PSA FF.</p>
</div>
<p>Here is a manifest reference example for the IPC model:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use SFN model, the user needs to replace <code class="docutils literal notranslate"><span class="pre">&quot;model&quot;:</span> <span class="pre">&quot;IPC&quot;</span></code> to
<code class="docutils literal notranslate"><span class="pre">&quot;model&quot;:</span> <span class="pre">&quot;SFN&quot;</span></code>. The user also needs to remove the attribute
<code class="docutils literal notranslate"><span class="pre">&quot;entry_point&quot;</span></code>, and optionally replace it with <code class="docutils literal notranslate"><span class="pre">&quot;entry_init&quot;</span></code>.</p>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
<span class="w">  </span><span class="s">&quot;psa_framework_version&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1.1</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;TFM_SP_EXAMPLE&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;type&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;APPLICATION-ROT&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;priority&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;NORMAL&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;model&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;IPC&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;entry_point&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;tfm_example_main&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;stack_size&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;0x0200&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;services&quot;</span><span class="nt"> </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">    </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">&quot;name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;ROT_A&quot;</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;sid&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;0x000000E0&quot;</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;non_secure_clients&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;connection_based&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;version&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;version_policy&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;STRICT&quot;</span>
<span class="w">      </span><span class="s">&quot;mm_iovec&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;disable&quot;</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">],</span>
<span class="w">  </span><span class="s">&quot;mmio_regions&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">    </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">&quot;name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;TFM_PERIPHERAL_A&quot;</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;permission&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;READ-WRITE&quot;</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">],</span>
<span class="w">  </span><span class="s">&quot;irqs&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">    </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">&quot;source&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;TFM_A_IRQ&quot;</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;A_IRQ&quot;</span><span class="p p-Indicator">,</span>
<span class="w">      </span><span class="s">&quot;handling&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;SLIH&quot;</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="s">&quot;dependencies&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">    </span><span class="s">&quot;TFM_CRYPTO&quot;</span><span class="p p-Indicator">,</span>
<span class="w">    </span><span class="s">&quot;TFM_INTERNAL_TRUSTED_STORAGE_SERVICE&quot;</span>
<span class="w">  </span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
<section id="secure-partition-id-distribution">
<h4>Secure Partition ID Distribution<a class="headerlink" href="#secure-partition-id-distribution" title="Permalink to this heading"></a></h4>
<p>Every Secure Partition has an identifier (ID). TF-M will generate a header file
that includes definitions of the Secure Partition IDs. The header file is
<code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">build</span> <span class="pre">folder&gt;generated/interface/include/psa_manifest/pid.h</span></code>. Each
definition uses the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute in the manifest as its name and the
value is allocated by SPM.</p>
<p>The Partition ID can be set to a fixed value or omitted to be auto allocated.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define name id-value</span>
</pre></div>
</div>
<table class="colwidths-auto docutils align-default" id="id2">
<caption><span class="caption-number">Table 36: </span><span class="caption-text">PID table</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Secure Partitions</strong></p></th>
<th class="head"><p><strong>PID Range</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TF-M Internal Partitions</p></td>
<td><p>0 - 255</p></td>
</tr>
<tr class="row-odd"><td><p>PSA and user Partitions</p></td>
<td><p>256 - 2999</p></td>
</tr>
<tr class="row-even"><td><p>TF-M test Partitions</p></td>
<td><p>3000 - 4999</p></td>
</tr>
<tr class="row-odd"><td><p>Firmware Framework test Partitions</p></td>
<td><p>5000 - 5999</p></td>
</tr>
<tr class="row-even"><td><p>Reserved</p></td>
<td><p>6000 -</p></td>
</tr>
</tbody>
</table>
<p>Please refer to <code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/tools/tfm_manifest_list.yaml</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">test</span> <span class="pre">repo&gt;/test/secure_fw/tfm_test_manifest_list.yaml</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/tools/tfm_psa_ff_test_manifest_list.yaml</span></code> for the detailed
PID allocations.</p>
<p>About where to add the definition, please refer to the chapter <a class="reference internal" href="#add-configuration">Add
configuration</a>.</p>
</section>
<section id="rot-service-id-sid-distribution">
<h4>RoT Service ID (SID) Distribution<a class="headerlink" href="#rot-service-id-sid-distribution" title="Permalink to this heading"></a></h4>
<p>An RoT Service is identified by its RoT Service ID (SID). A SID is a 32-bit
number that is associated with a symbolic name in the Secure Partition
manifest. The bits [31:12] uniquely identify the vendor of the RoT Service.
The remaining bits [11:0] can be used at the discretion of the vendor.</p>
<p>Here is the RoT Service ID table used in TF-M.</p>
<table class="colwidths-auto docutils align-default" id="id3">
<caption><span class="caption-number">Table 37: </span><span class="caption-text">SID table</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Partitions</strong></p></th>
<th class="head"><p><strong>Vendor ID(20 bits)</strong></p></th>
<th class="head"><p><strong>Function ID(12 bits)</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>initial_attestation</p></td>
<td><p>0x00000</p></td>
<td><p>0x020-0x03F</p></td>
</tr>
<tr class="row-odd"><td><p>platform</p></td>
<td><p>0x00000</p></td>
<td><p>0x040-0x05F</p></td>
</tr>
<tr class="row-even"><td><p>protected_storage</p></td>
<td><p>0x00000</p></td>
<td><p>0x060-0x06F</p></td>
</tr>
<tr class="row-odd"><td><p>internal_trusted_storage</p></td>
<td><p>0x00000</p></td>
<td><p>0x070-0x07F</p></td>
</tr>
<tr class="row-even"><td><p>crypto</p></td>
<td><p>0x00000</p></td>
<td><p>0x080-0x09F</p></td>
</tr>
<tr class="row-odd"><td><p>firmware_update</p></td>
<td><p>0x00000</p></td>
<td><p>0x0A0-0x0BF</p></td>
</tr>
<tr class="row-even"><td><p>tfm_secure_client</p></td>
<td><p>0x0000F</p></td>
<td><p>0x000-0x01F</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_ipc_client</p></td>
<td><p>0x0000F</p></td>
<td><p>0x060-0x07F</p></td>
</tr>
<tr class="row-even"><td><p>tfm_ipc_service</p></td>
<td><p>0x0000F</p></td>
<td><p>0x080-0x09F</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_slih_test_service</p></td>
<td><p>0x0000F</p></td>
<td><p>0x0A0-0x0AF</p></td>
</tr>
<tr class="row-even"><td><p>tfm_flih_test_service</p></td>
<td><p>0x0000F</p></td>
<td><p>0x0B0-0x0BF</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_ps_test_service</p></td>
<td><p>0x0000F</p></td>
<td><p>0x0C0-0x0DF</p></td>
</tr>
<tr class="row-even"><td><p>tfm_secure_client_2</p></td>
<td><p>0x0000F</p></td>
<td><p>0x0E0-0x0FF</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_sfn_test_service_1</p></td>
<td><p>0x0000F</p></td>
<td><p>0x100-0x11F</p></td>
</tr>
<tr class="row-even"><td><p>tfm_sfn_test_service_2</p></td>
<td><p>0x0000F</p></td>
<td><p>0x120-0x13F</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_attest_test_service</p></td>
<td><p>0x0000F</p></td>
<td><p>0x140-0x15F</p></td>
</tr>
</tbody>
</table>
</section>
<section id="rot-service-stateless-handle-distribution">
<h4>RoT Service Stateless Handle Distribution<a class="headerlink" href="#rot-service-stateless-handle-distribution" title="Permalink to this heading"></a></h4>
<p>A Secure partition may include stateless services. They are distinguished and
referenced by stateless handles. In manifest, a <code class="docutils literal notranslate"><span class="pre">stateless_handle</span></code> attribute
is set for indexing stateless services. It must be either <code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> or a
number in the range [1, 32] in current implementation and may extend. Also the
<code class="docutils literal notranslate"><span class="pre">connection-based</span></code> attribute must be set to <code class="docutils literal notranslate"><span class="pre">false</span></code> for stateless services.</p>
<p>The indexes of stateless handles are divided into two ranges for different
usages.
Indexes [1, 16] are assigned to TF-M Secure Partitions.
The rest indexes [17, 32] are reserved for any other Secure Partitions, for
example Secure Partitions in <code class="docutils literal notranslate"><span class="pre">tf-m-tests</span></code> and <code class="docutils literal notranslate"><span class="pre">tf-m-extras</span></code>.</p>
<p>The following table summaries the stateless handle allocation for the TF-M
Secure Partitions.</p>
<table class="colwidths-auto docutils align-default" id="id4">
<caption><span class="caption-number">Table 38: </span><span class="caption-text">Stateless Handle table</span><a class="headerlink" href="#id4" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Partition name</strong></p></th>
<th class="head"><p><strong>Stateless Handle</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TFM_SP_CRYPTO</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>TFM_SP_PS</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>TFM_SP_ITS</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>TFM_SP_INITIAL_ATTESTATION</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>TFM_SP_FWU</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>TFM_SP_PLATFORM</p></td>
<td><p>6</p></td>
</tr>
</tbody>
</table>
<p>For the indexes of other Secure Partitions, please refer to their manifests or
documentations.</p>
</section>
<section id="stack-size">
<h4>stack_size<a class="headerlink" href="#stack-size" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">stack_size</span></code> is required to indicate the stack memory usage of the Secure
Partition.
The value of this attribute must be a decimal or hexadecimal value in bytes.
It can also be a build configurable with default value defined in
<code class="docutils literal notranslate"><span class="pre">config_base.cmake</span></code>.
The value of the configuration can be overridden to fit different use cases.</p>
</section>
<section id="heap-size">
<h4>heap_size<a class="headerlink" href="#heap-size" title="Permalink to this heading"></a></h4>
<p>This attribute is optional. The default value is 0.
It indicates the heap memory usage of the Secure Partition.
The allowed values are the same as the <code class="docutils literal notranslate"><span class="pre">stack_size</span></code>.</p>
</section>
<section id="mmio-regions">
<h4>mmio_regions<a class="headerlink" href="#mmio-regions" title="Permalink to this heading"></a></h4>
<p>This attribute is a list of MMIO region objects which the Secure Partition
needs access to. TF-M only supports the <code class="docutils literal notranslate"><span class="pre">named_region</span></code> current. Please refer
to PSA FF for more details about it. The user needs to provide a name macro to
indicate the variable of the memory region.</p>
<p>TF-M uses the below structure to indicate a peripheral memory.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">platform_data_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">periph_start</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">periph_limit</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int16_t</span><span class="w"> </span><span class="n">periph_ppc_bank</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int16_t</span><span class="w"> </span><span class="n">periph_ppc_loc</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This structure is not expected by TF-M, it’s only that the current
implementations are using. Other peripherals that need different information
to create isolation need to define a different structure with the same name.</p>
</div>
<p>Here is an example for it:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">platform_data_t</span><span class="w"> </span><span class="n">tfm_peripheral_A</span><span class="p">;</span>
<span class="cp">#define TFM_PERIPHERAL_A                 (&amp;tfm_peripheral_A)</span>
</pre></div>
</div>
</section>
</section>
<section id="add-configuration">
<h3>Add configuration<a class="headerlink" href="#add-configuration" title="Permalink to this heading"></a></h3>
<p>The following configuration tasks are required for the newly added secure
partition:</p>
<section id="add-cmake-configure-files">
<h4>Add CMake configure files<a class="headerlink" href="#add-cmake-configure-files" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/secure_fw/partitions/example/CMakeLists.txt</span></code>, which is
the compilation configuration for this module. Add library
<code class="docutils literal notranslate"><span class="pre">tfm_app_rot_partition_example</span></code> and associated source files.</p></li>
</ul>
<p>Here is a reference example for <a class="reference external" href="https://git.trustedfirmware.org/TF-M/tf-m-tools.git/tree/example_partition/CMakeLists.txt">CMakeLists.txt</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The secure partition must be built as a standalone static library, and the
name of the library must follow this pattern, as it affects how the linker
script will lay the partition in memory:
- <code class="docutils literal notranslate"><span class="pre">tfm_psa_rot_partition*</span></code> in case of a PSA RoT partition
- <code class="docutils literal notranslate"><span class="pre">tfm_app_rot_partition*</span></code> in case of an Application RoT partition</p>
</div>
<p>The current CMake configuration should also be updated, by updating
<code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/config/config_base.cmake</span></code>
to include the CMake configuration variable of the newly added Secure
Partition, e.g, TFM_PARTITION_EXAMPLE and adding the relevant
subdirectory in <code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/secure_fw/CMakeLists.txt</span></code>, e.g.
<code class="docutils literal notranslate"><span class="pre">add_subdirectory(partitions/example)</span></code>.
Please refer to the source code of TF-M for more detail.</p>
</section>
<section id="update-manifest-list">
<h4>Update manifest list<a class="headerlink" href="#update-manifest-list" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/tools/tfm_manifest_list.yaml</span></code> is used to collect
necessary information of secure partition.
The manifest tool <code class="docutils literal notranslate"><span class="pre">tools/tfm_parse_manifest_list.py</span></code> processes it and
generates necessary files while building.</p>
<p>Please refer to the <a class="reference internal" href="tfm_manifest_tool_user_guide.html#tfm-manifest-list"><span class="std std-ref">Manifest List</span></a> for the format of manifest lists.</p>
<p>Reference configuration example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
<span class="w">  </span><span class="s">&quot;description&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;TFM</span><span class="nv"> </span><span class="s">Example</span><span class="nv"> </span><span class="s">Partition&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;manifest&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;secure_fw/partitions/example/tfm_example_partition.yaml&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;conditional&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;@TFM_PARTITION_EXAMPLE@&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;output_path&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;partitions/example&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;version_major&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;version_minor&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;pid&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">290</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;linker_pattern&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">    </span><span class="s">&quot;library_list&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">      </span><span class="s">&quot;*tfm_*partition_example*&quot;</span>
<span class="w">     </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>TF-M also supports out-of-tree Secure Partition build where you can have your
own manifest lists.
Please refer to <a class="reference internal" href="#out-of-tree-secure-partition-build">Out-of-tree Secure Partition build</a> for details.</p>
</section>
</section>
<section id="implement-the-rot-services">
<h3>Implement the RoT services<a class="headerlink" href="#implement-the-rot-services" title="Permalink to this heading"></a></h3>
<p>To implement RoT services, the partition needs a source file which contains the
implementations of the services, as well as the partition entry point. The user
can create this source file under
<code class="docutils literal notranslate"><span class="pre">&lt;TF-M</span> <span class="pre">base</span> <span class="pre">folder&gt;/secure_fw/partitions/example/tfm_example_partition.c</span></code>.</p>
<p>As an example, the RoT service with SID <strong>ROT_A</strong> will be implemented.</p>
<section id="entry-point-for-ipc-model-partitions">
<h4>Entry point for IPC Model Partitions<a class="headerlink" href="#entry-point-for-ipc-model-partitions" title="Permalink to this heading"></a></h4>
<p>This function must have a loop that repeatedly waits for input signals and
then processes them, following the Secure Partition initialization.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;psa_manifest/tfm_example.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;psa/service.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">tfm_example_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">psa_signal_t</span><span class="w"> </span><span class="n">signals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Secure Partition initialization */</span>
<span class="w">    </span><span class="n">example_init</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * Continually wait for one or more of the partition&#39;s RoT Service or</span>
<span class="cm">     * interrupt signals to be asserted and then handle the asserted</span>
<span class="cm">     * signal(s).</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">signals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">psa_wait</span><span class="p">(</span><span class="n">PSA_WAIT_ANY</span><span class="p">,</span><span class="w"> </span><span class="n">PSA_BLOCK</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signals</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ROT_A_SIGNAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">rot_A</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/* Should not come here */</span>
<span class="w">            </span><span class="n">psa_panic</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="entry-init-for-sfn-model-partitions">
<h4>Entry init for SFN Model Partitions<a class="headerlink" href="#entry-init-for-sfn-model-partitions" title="Permalink to this heading"></a></h4>
<p>In the SFN model, the Secure Partition consists of one optional initialization
function, which is declared as the <code class="docutils literal notranslate"><span class="pre">entry_init</span></code> symbol as mentioned in
section <a class="reference internal" href="#add-manifest">Add manifest</a>. After initialization, the entry_init function
returns the following values:</p>
<blockquote>
<div><ul class="simple">
<li><p>Return <code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code> if initialization succeeds.</p></li>
<li><p>Return <code class="docutils literal notranslate"><span class="pre">PSA_SUCCESS</span></code> if initialization is partially successful,
and you want some SFNs to receive messages. RoT Services that are
non-operational must respond to connection requests with
<code class="docutils literal notranslate"><span class="pre">PSA_ERROR_CONNECTION_REFUSED</span></code>.</p></li>
<li><p>Return an error status if the initialization failed, and no SFNs
within the Secure Partition must be called.</p></li>
</ul>
</div></blockquote>
</section>
<section id="service-implementation-for-ipc-model">
<h4>Service implementation for IPC Model<a class="headerlink" href="#service-implementation-for-ipc-model" title="Permalink to this heading"></a></h4>
<p>The service is implemented by the <code class="docutils literal notranslate"><span class="pre">rot_A()</span></code> function, which is called upon an
incoming signal. This implementation is up to the user, however an example
service has been included for reference. The following example sends a message
“Hello World” when called.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;psa_manifest/tfm_example.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;psa/service.h&quot;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">rot_A</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BUFFER_LEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>
<span class="w">    </span><span class="n">psa_msg_t</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">rec_buf</span><span class="p">[</span><span class="n">BUFFER_LEN</span><span class="p">];</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">send_buf</span><span class="p">[</span><span class="n">BUFFER_LEN</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="n">psa_get</span><span class="p">(</span><span class="n">ROT_A_SIGNAL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PSA_IPC_CONNECT</span><span class="p">:</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PSA_IPC_DISCONNECT</span><span class="p">:</span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">         * This service does not require any setup or teardown on connect</span>
<span class="cm">         * or disconnect, so just reply with success.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="n">psa_reply</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">PSA_SUCCESS</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PSA_IPC_CALL</span><span class="p">:</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">PSA_MAX_IOVEC</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">in_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">psa_read</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">rec_buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_LEN</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">out_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">psa_write</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">send_buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_LEN</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">psa_reply</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">PSA_SUCCESS</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">        </span><span class="cm">/* cannot get here [broken SPM] */</span>
<span class="w">        </span><span class="n">psa_panic</span><span class="p">();</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="service-implementation-for-sfn-model">
<h4>Service implementation for SFN Model<a class="headerlink" href="#service-implementation-for-sfn-model" title="Permalink to this heading"></a></h4>
<p>SFN model consists of a set of Secure Functions (SFN), one for each RoT
Service. The connection, disconnection and request messages do not cause a
Secure Partition signal to be asserted for SFN Secure Partitions. Instead,
the Secure Function (SFN) for the RoT Service is invoked by the framework,
with the message details provided as a parameter to the SFN. To add a secure
function (SFN) to process messages for each RoT Service, each SFN will have
following prototype.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">psa_status_t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">name</span><span class="o">&gt;&gt;</span><span class="n">_sfn</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">psa_msg_t</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">);</span>
</pre></div>
</div>
<p>A connection-based example service has been included for reference which
sends a message “Hello World” when called.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;psa_manifest/tfm_example.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;psa/service.h&quot;</span>

<span class="n">psa_status_t</span><span class="w"> </span><span class="nf">rot_a_sfn</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">psa_msg_t</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BUFFER_LEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">rec_buf</span><span class="p">[</span><span class="n">BUFFER_LEN</span><span class="p">];</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">send_buf</span><span class="p">[</span><span class="n">BUFFER_LEN</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PSA_IPC_CONNECT</span><span class="p">:</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PSA_IPC_DISCONNECT</span><span class="p">:</span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">         * This service does not require any setup or teardown on connect</span>
<span class="cm">         * or disconnect, so just reply with success.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PSA_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PSA_IPC_CALL</span><span class="p">:</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">PSA_MAX_IOVEC</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">in_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">psa_read</span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">rec_buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_LEN</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="o">-&gt;</span><span class="n">out_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">psa_write</span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">send_buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_LEN</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PSA_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">        </span><span class="cm">/* cannot get here [broken SPM] */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PSA_ERROR_PROGRAMMER_ERROR</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="test-suites-and-test-partitions">
<h4>Test suites and test partitions<a class="headerlink" href="#test-suites-and-test-partitions" title="Permalink to this heading"></a></h4>
<p>A regression test suite can be added to verify whether the new secure partition
works as expected. Refer to
<a class="reference external" href="https://git.trustedfirmware.org/TF-M/tf-m-tests.git/tree/docs/tfm_test_suites_addition.rst">Adding TF-M Regression Test Suite</a>
for the details of adding a regression test suite.</p>
<p>Some regression tests require a dedicated RoT service. The implementations of
the RoT service for test are similar to secure partition addition. Refer to
<a class="reference external" href="https://git.trustedfirmware.org/TF-M/tf-m-tests.git/tree/docs/tfm_test_services_addition.rst">Adding partitions for regression tests</a>
to get more information.</p>
</section>
<section id="out-of-tree-secure-partition-build">
<h4>Out-of-tree Secure Partition build<a class="headerlink" href="#out-of-tree-secure-partition-build" title="Permalink to this heading"></a></h4>
<p>TF-M supports out-of-tree Secure Partition build, whose source code folders
are maintained outside TF-M repo. Developers can configure
<code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_MANIFEST_LIST_FILES</span></code> and <code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_PARTITION_PATHS</span></code> in build
command line to include out-of-tree Secure Partitions.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_MANIFEST_LIST_FILES</span></code></p>
<p>A list of the absolute path(s) of the manifest list(s) provided by out-of-tree
Secure Partition(s).
Use semicolons <code class="docutils literal notranslate"><span class="pre">;</span></code> to separate multiple manifest lists. Wrap the multiple
manifest lists with double quotes.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_PARTITION_PATHS</span></code></p>
<p>A list of the absolute directories of the out-of-tree Secure Partition source
code folder(s). TF-M build system searches <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> of partitions in
the source code folder(s).
Use semicolons <code class="docutils literal notranslate"><span class="pre">;</span></code> to separate multiple out-of-tree Secure Partition
directories. Wrap the multiple directories with double quotes.</p>
</li>
</ul>
<p>A single out-of-tree Secure Partition folder can be organized as the figure
below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>secure partition folder
      ├── CMakeLists.txt
      ├── manifest_list.yaml
      ├── out_of_tree_partition_manifest.yaml
      └── source code
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_MANIFEST_LIST_FILES</span></code> and
<code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_PARTITION_PATHS</span></code> in the build command can be configured as listed
below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-DTFM_EXTRA_MANIFEST_LIST_FILES<span class="o">=</span>&lt;Absolute-path-sp-folder/manifest_list.yaml&gt;
-DTFM_EXTRA_PARTITION_PATHS<span class="o">=</span>&lt;Absolute-path-sp-folder&gt;
</pre></div>
</div>
<p>Multiple out-of-tree Secure Partitions can be organized in diverse structures.
For example, multiple Secure Partitions can be maintained under the same
directory as shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>top-level folder
      ├── Partition 1
      │       ├── CMakeLists.txt
      │       ├── partition_1_manifest.yaml
      │       └── source code
      ├── Partition 2
      │       └── ...
      ├── Partition 3
      │       └── ...
      ├── manifest_list.yaml
      └── Root CMakeLists.txt
</pre></div>
</div>
<p>In the example above, a root CMakeLists.txt includes all the partitions’
CMakLists.txt, for example via <code class="docutils literal notranslate"><span class="pre">add_subdirectory()</span></code>. The manifest_list.yaml
lists all partitions’ manifest files.
<code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_MANIFEST_LIST_FILES</span></code> and <code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_PARTITION_PATHS</span></code> in build
command line can be configured as listed below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-DTFM_EXTRA_MANIFEST_LIST_FILES<span class="o">=</span>&lt;Absolute-path-top-level-folder/manifest_list.yaml&gt;
-DTFM_EXTRA_PARTITION_PATHS<span class="o">=</span>&lt;Absolute-path-top-level-folder&gt;
</pre></div>
</div>
<p>Alternatively, out-of-tree Secure Partitions can be separated in different
folders.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>partition 1 folder                    partition 2 folder
    ├── CMakeLists.txt                    ├── CMakeLists.txt
    ├── manifest_list.yaml                ├── manifest_list.yaml
    ├── partition_1_manifest.yaml         ├── partition_2_manifest.yaml
    └── source code                       └── source code
</pre></div>
</div>
<p>In the example above, each Secure Partition manages its own manifest files and
CMakeLists.txt. <code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_MANIFEST_LIST_FILES</span></code> and
<code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_PARTITION_PATHS</span></code> in build command line can be configured as listed
below. Please note those input shall be wrapped with double quotes.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-DTFM_EXTRA_MANIFEST_LIST_FILES<span class="o">=</span><span class="s2">&quot;&lt;Absolute-path-part-1-folder/manifest_list.yaml&gt;;&lt;Absolute-path-part-2-folder/manifest_list.yaml&gt;&quot;</span>
-DTFM_EXTRA_PARTITION_PATHS<span class="o">=</span><span class="s2">&quot;&lt;Absolute-path-part-1-folder&gt;;&lt;Absolute-path-part-2-folder&gt;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Manifest list paths in <code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_MANIFEST_LIST_FILES</span></code> do NOT have to be
one-to-one mapping to Secure Partition directories in
<code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_PARTITION_PATHS</span></code>. The orders don’t matter either.</p>
</div>
</section>
<section id="further-notes">
<h4>Further Notes<a class="headerlink" href="#further-notes" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>In the IPC model, Use PSA FF proposed memory accessing mechanism. SPM
provides APIs and checking between isolation boundaries, a free accessing
of memory can cause program panic.</p></li>
<li><p>In the IPC model, the memory checking inside partition runtime is
unnecessary. SPM handles the checking while memory accessing APIs are
called.</p></li>
<li><p>In the IPC model, the client ID had been included in the message structure
and secure partition can get it when calling psa_get() function. The secure
partition does not need to call <code class="docutils literal notranslate"><span class="pre">tfm_core_get_caller_client_id()</span></code> to get
the caller client ID anymore.</p></li>
<li><p>In the IPC model, SPM will check the security policy and partition
dependence between client and service. So the service does not need to
validate the secure caller anymore.</p></li>
</ul>
</section>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA Firmware Framework specification</a></div>
<div class="line"><a class="reference external" href="https://developer.arm.com/documentation/aes0039/latest">Firmware Framework for M 1.1 Extensions</a></div>
</div>
<hr class="docutils" />
<p><em>Copyright (c) 2019-2022, Arm Limited. All rights reserved.</em>
<em>Copyright (c) 2022 Cypress Semiconductor Corporation (an Infineon company)
or an affiliate of Cypress Semiconductor Corporation. All rights reserved.</em></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>