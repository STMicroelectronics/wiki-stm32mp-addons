<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Symmetric key algorithm based Initial Attestation &mdash; Trusted Firmware-M v1.7.0-stm32mp25-alpha-r1-rc3-doc documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TF-M builtin keys" href="tfm_builtin_keys.html" />
    <link rel="prev" title="Stateless Root of Trust Services Reference" href="stateless_rot_service.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Trusted Firmware-M
            <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v1.7.0-stm32mp25-alpha-r1-rc3-doc

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/index.html">Threat Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Trusted Firmware-M Generic Threat Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.7.0.html">v1.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.1.html">v1.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.0.html">v1.6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.5.0.html">v1.5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platform Selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an547/README.html">Corstone-300 FPGA (AN547)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an552/README.html">Corstone-300 FPGA and FVP (AN552)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rss/readme.html">Runtime Security Subsystem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">Cypress PSoC64</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/cypress_psoc64_spec.html">Cypress PSoC64 Specifics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/README.html">Core Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/RELEASE.html">Core Library Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">Nordic nRF5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">Nordic nRF9160</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">Laird Connectivity BL5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/profiles/index.html">Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium.html"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_guide/index.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_folder.html">Details for the platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_ext_folder.html">Details for the platform/ext folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/porting_TFM_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/services/index.html">Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html">Internal Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_secure_partition_addition.html">Adding a New Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_manifest_tool_user_guide.html">The manifest tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dual-cpu/index.html">Dual-CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/booting_a_dual_core_system.html">Booting a Dual-Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">Communication Prototype Between NSPE And SPE In Dual Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox Design in TF-M on Dual-core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/tfm_multi_core_access_check.html">Memory Access Check of Trusted Firmware-M in Multi-Core Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_sharing.html">Code sharing between independently linked XIP binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="enum_implicit_casting.html">Fixing implicit casting for C enumeration values</a></li>
<li class="toctree-l2"><a class="reference internal" href="ff_isolation.html">FF-M Isolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailbox_ns_agent_update.html">Mailbox NS Agent Design Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_key_management.html">Protected Storage service key management</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_boot_hw_key_integration.html">HW crypto key integration in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_boot_rollback_protection.html">Rollback protection in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_structure.html">Trusted Firmware-M Source Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="stateless_rot_service.html">Stateless Root of Trust Services Reference</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Symmetric key algorithm based Initial Attestation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_builtin_keys.html">TF-M builtin keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_code_generation_with_jinja2.html">Code Generation With Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_cooperative_scheduling_rules.html">Cooperative Scheduling Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_crypto_design.html">Crypto Service design</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_fwu_service.html">Firmware Update Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_its_512_flash.html">Add support for block-aligned flash in Internal Trusted Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_its_service.html">Internal Trusted Storage (ITS) Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_log_system_design_document.html">Log system design document</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_physical_attack_mitigation.html">Physical attack mitigation in Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_psa_inter_process_communication.html">TF-M Inter-Process Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_secure_boot.html">Secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_secure_partition_runtime_library.html">Secure Partition Runtime Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_uniform_secure_service_signature.html">Uniform Secure Service Signature</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/view/TF-M/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0-stm32mp25-alpha-r1-rc3/changelog.html">v1.7.0-stm32mp25-alpha-r1-rc3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cubeide/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Design Documents</a> &raquo;</li>
      <li>Symmetric key algorithm based Initial Attestation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="symmetric-key-algorithm-based-initial-attestation">
<h1>Symmetric key algorithm based Initial Attestation<a class="headerlink" href="#symmetric-key-algorithm-based-initial-attestation" title="Permalink to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>David Hu</p>
</dd>
<dt class="field-even">Organization</dt>
<dd class="field-even"><p>Arm Limited</p>
</dd>
<dt class="field-odd">Contact</dt>
<dd class="field-odd"><p><a class="reference external" href="mailto:david&#46;hu&#37;&#52;&#48;arm&#46;com">david<span>&#46;</span>hu<span>&#64;</span>arm<span>&#46;</span>com</a></p>
</dd>
</dl>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This document proposes a design of symmetric key algorithm based Initial
Attestation in TF-M.</p>
<p>Symmetric key algorithm based Initial Attestation
(<em>symmetric Initial Attestation</em> for short) signs and verifies Initial
Attestation Token (IAT) with a symmetric cryptography signature scheme, such as
HMAC.
It can reduce TF-M binary size and memory footprint on ultra-constrained devices
without integrating asymmetric ciphers.</p>
<p>This proposal follows PSA Attestation API document <a class="footnote-reference brackets" href="#id8" id="id1">1</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As pointed out by PSA Attestation API <a class="footnote-reference brackets" href="#id8" id="id2">1</a>, the use cases of Initial
Attestation based on symmetric key algorithms can be limited due to
the associated infrastructure costs for key management and operational
complexities. It may also restrict the ability to interoperate with
scenarios that involve third parties.</p>
</div>
</section>
<section id="design-overview">
<h2>Design overview<a class="headerlink" href="#design-overview" title="Permalink to this heading"></a></h2>
<p>The symmetric Initial Attestation follows the existing IAT generation sequence
for Initial Attestation based on asymmetric key algorithm
(<em>asymmetric Initial Attestation</em> for short).</p>
<p>As Profile Small design <a class="footnote-reference brackets" href="#id9" id="id3">2</a> requests, a configuration flag
<code class="docutils literal notranslate"><span class="pre">SYMMETRIC_INITIAL_ATTESTATION</span></code> selects symmetric initial attestation during
build.</p>
<p>The top-level design is shown in <a class="reference internal" href="#overall-diagram-figure"><span class="std std-ref">Overall design diagram</span></a> below.</p>
<figure class="align-center" id="id13">
<span id="overall-diagram-figure"></span><img alt="../../_images/overall_diagram.png" src="../../_images/overall_diagram.png" />
<figcaption>
<p><span class="caption-number">Figure 12: </span><span class="caption-text">Overall design diagram</span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Symmetric Initial Attestation adds its own implementations of some steps in IAT
generation in Initial Attestation secure service. More details are covered in
<a class="reference internal" href="#iat-generation-in-initial-attestation-secure-service">IAT generation in Initial Attestation secure service</a>.</p>
<p>The interfaces and procedures of Initial Attestation secure service are not
affected. Refer to Initial Attestation Service Integration Guide <a class="footnote-reference brackets" href="#id10" id="id4">3</a> for
details of the implementation of Initial Attestation secure service.</p>
<p>Symmetric Initial Attestation invokes <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> library to build up
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure.
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> support is added to <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> library in TF-M since official
<code class="docutils literal notranslate"><span class="pre">t_cose</span></code> hasn’t supported <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> yet. The design of <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code>
support is covered in <a class="reference internal" href="#cose-mac0-support-in-t-cose">COSE_Mac0 support in t_cose</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> implementation in this proposal is a prototype only for
Proof of Concept so far. It may be replaced after <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> officially
supports <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> message.</p>
</div>
<p>Several HAL APIs are defined to fetch platform specific assets required by
Symmetric Initial Attestation. For example, <code class="docutils literal notranslate"><span class="pre">tfm_plat_get_symmetric_iak()</span></code>
fetches symmetric Initial Attestation Key (IAK). Those HAL APIs are summarized
in <a class="reference internal" href="#hal-apis">HAL APIs</a>.</p>
<p>Decoding and verification of symmetric Initial Attestation is also included in
this proposal for regression test.
The test suites and IAT decoding are discussed in <a class="reference internal" href="#tf-m-test-suite">TF-M Test suite</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">QCBOR</span></code> library and Crypto service are also invoked. But this proposal doesn’t
require any modification to either <code class="docutils literal notranslate"><span class="pre">QCBOR</span></code> or Crypto service. Therefore,
descriptions of <code class="docutils literal notranslate"><span class="pre">QCBOR</span></code> and Crypto service are skipped in this document.</p>
</section>
<section id="iat-generation-in-initial-attestation-secure-service">
<h2>IAT generation in Initial Attestation secure service<a class="headerlink" href="#iat-generation-in-initial-attestation-secure-service" title="Permalink to this heading"></a></h2>
<p>The sequence of IAT generation of symmetric Initial Attestation is shown in
<a class="reference internal" href="#ia-service-figure"><span class="std std-ref">Symmetric IAT generation flow in Initial Attestation secure service</span></a> below. Note that the <code class="docutils literal notranslate"><span class="pre">Register</span> <span class="pre">symmetric</span> <span class="pre">IAK</span></code> stage
is no longer required due to changes in the Crypto partition
(<code class="docutils literal notranslate"><span class="pre">attest_symmetric_key.c</span></code> is now responsible only for calculating the instance
ID).</p>
<figure class="align-center" id="id14">
<span id="ia-service-figure"></span><img alt="../../_images/ia_service_flow.png" src="../../_images/ia_service_flow.png" />
<figcaption>
<p><span class="caption-number">Figure 13: </span><span class="caption-text">Symmetric IAT generation flow in Initial Attestation secure service</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>In Initial Attestation secure service, symmetric Initial Attestation implements
the following steps in <code class="docutils literal notranslate"><span class="pre">attest_create_token()</span></code>, which are different from those
of asymmetric Initial Attestation.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">attest_token_start()</span></code></p></li>
<li><p>Instance ID claims</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attest_token_finish()</span></code></p></li>
</ul>
</div></blockquote>
<p>If <code class="docutils literal notranslate"><span class="pre">SYMMETRIC_INITIAL_ATTESTATION</span></code> is selected, symmetric Initial Attestation
dedicated implementations of those steps are included in build.
Otherwise, asymmetric Initial Attestation dedicated implementations are included
instead.</p>
<p>Symmetric Initial Attestation implementation resides a new file
<code class="docutils literal notranslate"><span class="pre">attest_symmetric_key.c</span></code> to handle symmetric Instance ID related operations.
Symmetric Initial Attestation dedicated <code class="docutils literal notranslate"><span class="pre">attest_token_start()</span></code> and
<code class="docutils literal notranslate"><span class="pre">attest_token_finish()</span></code> are added in <code class="docutils literal notranslate"><span class="pre">attestation_token.c</span></code>.</p>
<p>The details are covered in following sections.</p>
<section id="symmetric-instance-id">
<h3>Symmetric Instance ID<a class="headerlink" href="#symmetric-instance-id" title="Permalink to this heading"></a></h3>
<p>Symmetric Initial Attestation dedicated <code class="docutils literal notranslate"><span class="pre">attest_symmetric_key.c</span></code> implements
the <code class="docutils literal notranslate"><span class="pre">attest_get_instance_id()</span></code> function. This function returns the Instance ID
value, calculating it if it has not already been calculated. Refer to
<cite>Instance ID claim_</cite> for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only symmetric IAK for HMAC algorithm is allowed so far.</p>
</div>
<section id="instance-id-calculation">
<h4>Instance ID calculation<a class="headerlink" href="#instance-id-calculation" title="Permalink to this heading"></a></h4>
<p>In symmetric Initial Attestation, Instance ID is also calculated the first time
it is requested. It can protect critical symmetric IAK from being frequently
fetched, which increases the risk of asset disclosure.</p>
<p>The Instance ID value is the output of hashing symmetric IAK raw data <em>twice</em>,
as requested in PSA Attestation API <a class="footnote-reference brackets" href="#id8" id="id5">1</a>. HMAC-SHA256 may be hard-coded as the
hash algorithm of Instance ID calculation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>According to RFC2104 <a class="footnote-reference brackets" href="#id11" id="id6">4</a>, if a HMAC key is longer than the HMAC block size,
the key will be first hashed. The hash output is used as the key in HMAC
computation.</p>
<p>In current design, HMAC is used to calculate the authentication tag of
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code>. Assume that symmetric IAK is longer than HMAC block size
(HMAC-SHA256 by default), the Instance ID is actually the HMAC key for
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> authentication tag generation, if Instance ID value is the
output of hashing IAK only <em>once</em>.
Therefore, attackers may request an valid IAT from device and fake malicious
ones by using Instance ID to calculate valid authentication tags, to cheat
others.</p>
<p>As a result, symmetric IAK raw data should be hashed <em>twice</em> to generate the
Instance ID value.</p>
</div>
<p>The Instance ID calculation result is stored in a static buffer.
Token generation process can call <code class="docutils literal notranslate"><span class="pre">attest_get_instance_id()</span></code> to
fetch the data from that static buffer.</p>
</section>
</section>
<section id="attest-token-start">
<h3>attest_token_start()<a class="headerlink" href="#attest-token-start" title="Permalink to this heading"></a></h3>
<p>Symmetric Initial Attestation dedicated <code class="docutils literal notranslate"><span class="pre">attest_token_start()</span></code> initializes the
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> signing context and builds up the <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> Header.</p>
<p>The workflow inside <code class="docutils literal notranslate"><span class="pre">attest_token_start()</span></code> is shown in
<a class="reference internal" href="#attest-token-start-figure"><span class="std std-ref">Workflow in symmetric Initial Attestation attest_token_start()</span></a> below.</p>
<figure class="align-center" id="id15">
<span id="attest-token-start-figure"></span><img alt="../../_images/attest_token_start.png" src="../../_images/attest_token_start.png" />
<figcaption>
<p><span class="caption-number">Figure 14: </span><span class="caption-text">Workflow in symmetric Initial Attestation <code class="docutils literal notranslate"><span class="pre">attest_token_start()</span></code></span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Descriptions of each step are listed below:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_sign_init()</span></code> is invoked to initialize <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> signing
context in <code class="docutils literal notranslate"><span class="pre">t_cose</span></code>.</p></li>
<li><p>The symmetric IAK handle is set into <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> signing context via
<code class="docutils literal notranslate"><span class="pre">t_cose_mac0_set_signing_key()</span></code>.</p></li>
<li><p>Initialize <code class="docutils literal notranslate"><span class="pre">QCBOR</span></code> encoder.</p></li>
<li><p>The header parameters are encoded into <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure in
<code class="docutils literal notranslate"><span class="pre">t_cose_mac0_encode_parameters()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QCBOREncode_OpenMap()</span></code> prepares for encoding the <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> payload,
which is filled with IAT claims.</p></li>
</ol>
<p>All the <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> functionalities in <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> are covered in
<a class="reference internal" href="#cose-mac0-support-in-t-cose">COSE_Mac0 support in t_cose</a>.</p>
</section>
<section id="instance-id-claim">
<h3>Instance ID claim<a class="headerlink" href="#instance-id-claim" title="Permalink to this heading"></a></h3>
<p>Symmetric Initial Attestation also implements Instance ID claims in
<code class="docutils literal notranslate"><span class="pre">attest_add_instance_id_claim()</span></code>.</p>
<p>The Instance ID value is fetched via <code class="docutils literal notranslate"><span class="pre">attest_get_instance_id()</span></code>.
The value has already been calculated during symmetric IAK registration. See
<a class="reference internal" href="#instance-id-calculation">Instance ID calculation</a> for details.</p>
<p>The other steps are the same as those in asymmetric Initial Attestation
implementation. The UEID type byte is set to 0x01.</p>
</section>
<section id="attest-token-finish">
<h3>attest_token_finish()<a class="headerlink" href="#attest-token-finish" title="Permalink to this heading"></a></h3>
<p>Symmetric Initial Attestation dedicated <code class="docutils literal notranslate"><span class="pre">attest_token_finish()</span></code> calls
<code class="docutils literal notranslate"><span class="pre">t_cose_mac0_encode_tag()</span></code> to calculate and encode the authentication tag of
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure.</p>
<p>The whole COSE and CBOR encoding are completed in <code class="docutils literal notranslate"><span class="pre">attest_token_finish()</span></code>.</p>
<p>The simplified flow in <code class="docutils literal notranslate"><span class="pre">attest_token_finish()</span></code> is shown in
<a class="reference internal" href="#attest-token-finish-figure"><span class="std std-ref">Workflow in symmetric Initial Attestation attest_token_finish()</span></a> below.</p>
<figure class="align-center" id="id16">
<span id="attest-token-finish-figure"></span><img alt="../../_images/attest_token_finish.png" src="../../_images/attest_token_finish.png" />
<figcaption>
<p><span class="caption-number">Figure 15: </span><span class="caption-text">Workflow in symmetric Initial Attestation <code class="docutils literal notranslate"><span class="pre">attest_token_finish()</span></code></span><a class="headerlink" href="#id16" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="cose-mac0-support-in-t-cose">
<h2>COSE_Mac0 support in t_cose<a class="headerlink" href="#cose-mac0-support-in-t-cose" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> supports in <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> in TF-M include the following major
functionalities:</p>
<blockquote>
<div><ul class="simple">
<li><p>Encoding <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure</p></li>
<li><p>Decoding and verifying <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure</p></li>
<li><p>HMAC computation to generate and verify authentication tag</p></li>
<li><p>Short-circuit tagging for test mode</p></li>
</ul>
</div></blockquote>
<p>According to RFC8152 <a class="footnote-reference brackets" href="#id12" id="id7">5</a>, <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> and <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> have similar
structures. Therefore, the prototype follows <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> implementation to
build up <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> file structure and implement <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> encoding and
decoding.</p>
<p>Although <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> can share lots of data types, APIs and encoding/decoding
steps with <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> in implementation, this prototype separates
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> implementation from <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code>. <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> owns its
dedicated signing/verification contexts, APIs and encoding/decoding process.
The purposes of separating <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> and <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> are listed below</p>
<ul class="simple">
<li><p>It can keep changes to <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> as small as possible and avoid conflicts
with development in <code class="docutils literal notranslate"><span class="pre">COSE_Sign1`</span></code>. It can decrease conflicts if <code class="docutils literal notranslate"><span class="pre">t_cose</span></code>
in TF-M is synchronized with original <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> repository later.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> and <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> are exclusive in TF-M use cases.
It cannot decrease TF-M memory footprint by extracting the common components
shared by <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> and <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> but can make the design
over-complicated.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only HMAC is supported in current <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> prototype.</p>
</div>
<section id="file-structure">
<h3>File structure<a class="headerlink" href="#file-structure" title="Permalink to this heading"></a></h3>
<p>New files are added to implement the functionalities listed above. The structure
of files is shown in the table below.</p>
<table class="colwidths-auto docutils align-center" id="id17">
<caption><span class="caption-number">Table 43: </span><span class="caption-text">New files in <code class="docutils literal notranslate"><span class="pre">t_cose</span></code></span><a class="headerlink" href="#id17" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Directory</p></th>
<th class="head"><p>Files</p></th>
<th class="head"><p>Descriptions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p><code class="docutils literal notranslate"><span class="pre">src</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_sign.c</span></code></p></td>
<td><p>Encode <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_verify.c</span></code></p></td>
<td><p>Decode and verify <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure.</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p><code class="docutils literal notranslate"><span class="pre">inc</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_sign.h</span></code></p></td>
<td><p>Data type definitions and function
declarations of encoding and signing
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> message.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_verify.h</span></code></p></td>
<td><p>Data type definitions and function
declarations of verifying <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code>
message.</p></td>
</tr>
</tbody>
</table>
<p>Other <code class="docutils literal notranslate"><span class="pre">t_cose</span></code> files may also be changed to add <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> associated data
types and function declarations.</p>
<p>HMAC operations are added in <code class="docutils literal notranslate"><span class="pre">crypto_adapters/t_cose_psa_crypto.c</span></code>.
Preprocessor flags are added to select corresponding crypto for COSE message
signing and verification.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">T_COSE_ENABLE_SIGN1</span></code> selects ECDSA and Hash operations for
<code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T_COSE_ENABLE_MAC0</span></code> selects HMAC operations for <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="encoding-cose-mac0">
<h3>Encoding COSE_Mac0<a class="headerlink" href="#encoding-cose-mac0" title="Permalink to this heading"></a></h3>
<p>Following <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> implementation, <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> encoding exports similar
functions to Initial Attestation secure service.
The major functions are listed below.</p>
<section id="initialize-signing-context">
<h4>Initialize signing context<a class="headerlink" href="#initialize-signing-context" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_sign_init()</span></code> initializes <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> signing context and
configures option flags and algorithm used in signing.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">t_cose_mac0_sign_init</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_sign_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">me</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">int32_t</span><span class="w">                      </span><span class="n">option_flags</span><span class="p">,</span>
<span class="w">                      </span><span class="kt">int32_t</span><span class="w">                      </span><span class="n">cose_algorithm_id</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> signing context is defined as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_sign_ctx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Private data structure */</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w">               </span><span class="n">protected_parameters_buffer</span><span class="p">[</span>
<span class="w">                                </span><span class="n">T_COSE_MAC0_MAX_SIZE_PROTECTED_PARAMETERS</span><span class="p">];</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">q_useful_buf_c</span><span class="w"> </span><span class="n">protected_parameters</span><span class="p">;</span><span class="w"> </span><span class="cm">/* The encoded protected parameters */</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w">               </span><span class="n">cose_algorithm_id</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_key</span><span class="w">     </span><span class="n">signing_key</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w">               </span><span class="n">option_flags</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">q_useful_buf_c</span><span class="w"> </span><span class="n">kid</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="set-signing-key">
<h4>Set signing key<a class="headerlink" href="#set-signing-key" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_set_signing_key()</span></code> sets the key used in <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> signing.
Optional <code class="docutils literal notranslate"><span class="pre">kid</span></code>, as a key identifer, will be encoded into <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> Header
unprotected bucket.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">t_cose_mac0_set_signing_key</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_sign_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">me</span><span class="p">,</span>
<span class="w">                            </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_key</span><span class="w">            </span><span class="n">signing_key</span><span class="p">,</span>
<span class="w">                            </span><span class="k">struct</span><span class="w"> </span><span class="nc">q_useful_buf_c</span><span class="w">        </span><span class="n">kid</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="encode-header-parameters">
<h4>Encode Header parameters<a class="headerlink" href="#encode-header-parameters" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_encode_parameters()</span></code> encodes the <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> Header parameters
and outputs the encoded context to <code class="docutils literal notranslate"><span class="pre">cbor_encode_ctx</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">t_cose_err_t</span>
<span class="nf">t_cose_mac0_encode_parameters</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_sign_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">,</span>
<span class="w">                              </span><span class="n">QCBOREncodeContext</span><span class="w">          </span><span class="o">*</span><span class="n">cbor_encode_ctx</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="calculate-and-add-authentication-tag">
<h4>Calculate and add authentication tag<a class="headerlink" href="#calculate-and-add-authentication-tag" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_encode_tag()</span></code> calculates the authentication tag and finishes the
<code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> message.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">t_cose_err_t</span>
<span class="nf">t_cose_mac0_encode_tag</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_sign_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">,</span>
<span class="w">                       </span><span class="n">QCBOREncodeContext</span><span class="w">          </span><span class="o">*</span><span class="n">cbor_encode_ctx</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="decoding-cose-mac0">
<h3>Decoding COSE_Mac0<a class="headerlink" href="#decoding-cose-mac0" title="Permalink to this heading"></a></h3>
<p>Following <code class="docutils literal notranslate"><span class="pre">COSE_Sign1</span></code> implementation, <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> decoding exports similar
functions to test suite of Initial Attestation.
The major functions are listed below.</p>
<section id="initialize-verification-context">
<h4>Initialize verification context<a class="headerlink" href="#initialize-verification-context" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_verify_init()</span></code> initializes <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> verification context and
configures option flags in verification.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">t_cose_mac0_verify_init</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_verify_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">,</span>
<span class="w">                        </span><span class="kt">int32_t</span><span class="w">                        </span><span class="n">option_flags</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> verification context is defined as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_verify_ctx</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* Private data structure */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_key</span><span class="w">     </span><span class="n">verification_key</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w">               </span><span class="n">option_flags</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="set-verification-key">
<h4>Set verification key<a class="headerlink" href="#set-verification-key" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_set_verify_key()</span></code> sets the key for verifying <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code>
authentication tag.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span>
<span class="nf">t_cose_mac0_set_verify_key</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_verify_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">,</span>
<span class="w">                           </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_key</span><span class="w">              </span><span class="n">verify_key</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="decode-and-verify-cose-mac0">
<h4>Decode and verify COSE_Mac0<a class="headerlink" href="#decode-and-verify-cose-mac0" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">t_cose_mac0_verify()</span></code> decodes the <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure and verifies the
authentication tag.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">t_cose_err_t</span>
<span class="nf">t_cose_mac0_verify</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_mac0_verify_ctx</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="p">,</span>
<span class="w">                   </span><span class="k">struct</span><span class="w"> </span><span class="nc">q_useful_buf_c</span><span class="w">          </span><span class="n">cose_mac0</span><span class="p">,</span>
<span class="w">                   </span><span class="k">struct</span><span class="w"> </span><span class="nc">q_useful_buf_c</span><span class="w">         </span><span class="o">*</span><span class="n">payload</span><span class="p">,</span>
<span class="w">                   </span><span class="k">struct</span><span class="w"> </span><span class="nc">t_cose_parameters</span><span class="w">      </span><span class="o">*</span><span class="n">parameters</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="short-circuit-tagging">
<h3>Short-circuit tagging<a class="headerlink" href="#short-circuit-tagging" title="Permalink to this heading"></a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">T_COSE_OPT_SHORT_CIRCUIT_TAG</span></code> option is enabled, <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> encoding
will hash the <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> content and add the hash output as an authentication
tag. It is useful when critical symmetric IAK is unavailable or cannot be
accessed, perhaps because it has not been provisioned or configured for the
particular device. It is only for test and must not be used in actual use case.
The <code class="docutils literal notranslate"><span class="pre">kid</span></code> parameter will either be skipped in <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> Header.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">T_COSE_OPT_ALLOW_SHORT_CIRCUIT</span></code> option is enabled, <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> decoding
will only verify the hash output, without requiring symmetric key for
authentication tag verification.</p>
</section>
</section>
<section id="tf-m-test-suite">
<h2>TF-M Test suite<a class="headerlink" href="#tf-m-test-suite" title="Permalink to this heading"></a></h2>
<p>Symmetric Initial Attestation adds dedicated non-secure and secure test suites.
The test suites also follow asymmetric Initial Attestation test suites
implementation but optimize the memory footprint.
Symmetric Initial Attestation non-secure and secure test suites request Initial
Attestation secure service to generate IATs. After IATs are generated
successfully, test suites decode IATs and parse the claims.
Secure test suite also verifies the authentication tag in <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code>
structure.</p>
<p>Symmetric Initial Attestation implements its dedicated
<code class="docutils literal notranslate"><span class="pre">attest_token_decode_validate_token()</span></code> in <code class="docutils literal notranslate"><span class="pre">attest_symmetric_iat_decoded.c</span></code>
to perform IAT decoding required by test suites.
If <code class="docutils literal notranslate"><span class="pre">SYMMETRIC_INITIAL_ATTESTATION</span></code> is selected,
<code class="docutils literal notranslate"><span class="pre">attest_symmetric_iat_decoded.c</span></code> is included in build.
Otherwise, asymmetric Initial Attestation dedicated implementations are included
instead.</p>
<p>The workflow of symmetric Initial Attestation dedicated
<code class="docutils literal notranslate"><span class="pre">attest_token_decode_validate_token()</span></code> is shown below.</p>
<figure class="align-center" id="id18">
<span id="iat-decode-figure"></span><img alt="../../_images/iat_decode.png" src="../../_images/iat_decode.png" />
<figcaption>
<p><span class="caption-number">Figure 16: </span><span class="caption-text">Workflow in symmetric Initial Attestation <code class="docutils literal notranslate"><span class="pre">attest_token_decode_validate_token()</span></code></span><a class="headerlink" href="#id18" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>If the decoding is required from secure test suite,
<code class="docutils literal notranslate"><span class="pre">attest_token_decode_validate_token()</span></code> will fetch symmetric IAK to verify the
authentication tag in <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> structure.
If the decoding is required from non-secure test suite,
<code class="docutils literal notranslate"><span class="pre">attest_token_decode_validate_token()</span></code> will decode <code class="docutils literal notranslate"><span class="pre">COSE_Mac0</span></code> only by
setting <code class="docutils literal notranslate"><span class="pre">T_COSE_OPT_DECODE_ONLY</span></code> option flag. Non-secure must not access the
symmetric IAK.</p>
</section>
<section id="hal-apis">
<h2>HAL APIs<a class="headerlink" href="#hal-apis" title="Permalink to this heading"></a></h2>
<p>HAL APIs are summarized below.</p>
<section id="fetch-device-symmetric-iak">
<h3>Fetch device symmetric IAK<a class="headerlink" href="#fetch-device-symmetric-iak" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tfm_plat_get_symmetric_iak()</span></code> fetches device symmetric IAK.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">tfm_plat_err_t</span><span class="w"> </span><span class="nf">tfm_plat_get_symmetric_iak</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">key_buf</span><span class="p">,</span>
<span class="w">                                               </span><span class="kt">size_t</span><span class="w"> </span><span class="n">buf_len</span><span class="p">,</span>
<span class="w">                                               </span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="n">key_len</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">psa_algorithm_t</span><span class="w"> </span><span class="o">*</span><span class="n">key_alg</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 82%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">key_buf</span></code></p></td>
<td><p>Buffer to store the symmetric IAK.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">buf_len</span></code></p></td>
<td><p>The length of <code class="docutils literal notranslate"><span class="pre">key_buf</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">key_len</span></code></p></td>
<td><p>The length of the symmetric IAK.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">key_alg</span></code></p></td>
<td><p>The key algorithm. Only HMAC SHA-256 is supported so far.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>It returns error code specified in <code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">tfm_plat_err_t</span></code>.</p>
</section>
<section id="get-symmetric-iak-key-identifier">
<h3>Get symmetric IAK key identifier<a class="headerlink" href="#get-symmetric-iak-key-identifier" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">attest_plat_get_symmetric_iak_id()</span></code> gets the key identifier of the symmetric
IAK as the <code class="docutils literal notranslate"><span class="pre">kid</span></code> parameter in COSE Header.</p>
<p>Optional if device doesn’t install a key identifier for symmetric IAK.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="n">tfm_plat_err_t</span><span class="w"> </span><span class="nf">attest_plat_get_symmetric_iak_id</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">kid_buf</span><span class="p">,</span>
<span class="w">                                                     </span><span class="kt">size_t</span><span class="w"> </span><span class="n">buf_len</span><span class="p">,</span>
<span class="w">                                                     </span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="n">kid_len</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kid_buf</span></code></p></td>
<td><p>Buffer to store the IAK identifier.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">buf_len</span></code></p></td>
<td><p>The length of <code class="docutils literal notranslate"><span class="pre">kid_buf</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kid_len</span></code></p></td>
<td><p>The length of the IAK identifier.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>It returns error code specified in <code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">tfm_plat_err_t</span></code>.</p>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this heading"></a></h2>
<dl class="footnote brackets">
<dt class="label" id="id8"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>,<a href="#id5">3</a>)</span></dt>
<dd><p><a class="reference external" href="https://developer.arm.com/-/media/Files/pdf/PlatformSecurityArchitecture/Implement/IHI0085-PSA_Attestation_API-1.0.2.pdf?revision=eef78753-c77e-4b24-bcf0-65596213b4c1&amp;la=en&amp;hash=E5E0353D612077AFDCE3F2F3708A50C77A74B2A3">PSA Attestation API 1.0 (ARM IHI 0085)</a></p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"><span class="doc">Trusted Firmware-M Profile Small Design</span></a></p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html"><span class="doc">Initial Attestation Service Integration Guide</span></a></p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id6">4</a></span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a></p>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id7">5</a></span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc8152">CBOR Object Signing and Encryption (COSE)</a></p>
</dd>
</dl>
<hr class="docutils" />
<p><em>Copyright (c) 2020-2022 Arm Limited. All Rights Reserved.</em></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>