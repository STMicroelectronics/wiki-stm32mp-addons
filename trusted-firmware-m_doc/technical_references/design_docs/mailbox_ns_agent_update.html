<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mailbox NS Agent Design Update &mdash; Trusted Firmware-M v1.7.0-stm32mp25-alpha-r1-rc3-doc documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Protected Storage service key management" href="ps_key_management.html" />
    <link rel="prev" title="Hardware Abstraction Layer" href="hardware_abstraction_layer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Trusted Firmware-M
            <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v1.7.0-stm32mp25-alpha-r1-rc3-doc

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/index.html">Threat Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Trusted Firmware-M Generic Threat Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.7.0.html">v1.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.1.html">v1.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.0.html">v1.6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.5.0.html">v1.5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platform Selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an547/README.html">Corstone-300 FPGA (AN547)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an552/README.html">Corstone-300 FPGA and FVP (AN552)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rss/readme.html">Runtime Security Subsystem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">Cypress PSoC64</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/cypress_psoc64_spec.html">Cypress PSoC64 Specifics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/README.html">Core Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/RELEASE.html">Core Library Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">Nordic nRF5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">Nordic nRF9160</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">Laird Connectivity BL5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/profiles/index.html">Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium.html"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_guide/index.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_folder.html">Details for the platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_ext_folder.html">Details for the platform/ext folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/porting_TFM_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/services/index.html">Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html">Internal Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_secure_partition_addition.html">Adding a New Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_manifest_tool_user_guide.html">The manifest tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dual-cpu/index.html">Dual-CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/booting_a_dual_core_system.html">Booting a Dual-Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">Communication Prototype Between NSPE And SPE In Dual Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox Design in TF-M on Dual-core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/tfm_multi_core_access_check.html">Memory Access Check of Trusted Firmware-M in Multi-Core Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_sharing.html">Code sharing between independently linked XIP binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="enum_implicit_casting.html">Fixing implicit casting for C enumeration values</a></li>
<li class="toctree-l2"><a class="reference internal" href="ff_isolation.html">FF-M Isolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mailbox NS Agent Design Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_key_management.html">Protected Storage service key management</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_boot_hw_key_integration.html">HW crypto key integration in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_boot_rollback_protection.html">Rollback protection in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_structure.html">Trusted Firmware-M Source Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="stateless_rot_service.html">Stateless Root of Trust Services Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="symmetric_initial_attest.html">Symmetric key algorithm based Initial Attestation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_builtin_keys.html">TF-M builtin keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_code_generation_with_jinja2.html">Code Generation With Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_cooperative_scheduling_rules.html">Cooperative Scheduling Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_crypto_design.html">Crypto Service design</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_fwu_service.html">Firmware Update Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_its_512_flash.html">Add support for block-aligned flash in Internal Trusted Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_its_service.html">Internal Trusted Storage (ITS) Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_log_system_design_document.html">Log system design document</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_physical_attack_mitigation.html">Physical attack mitigation in Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_psa_inter_process_communication.html">TF-M Inter-Process Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_secure_boot.html">Secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_secure_partition_runtime_library.html">Secure Partition Runtime Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_uniform_secure_service_signature.html">Uniform Secure Service Signature</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/view/TF-M/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0-stm32mp25-alpha-r1-rc3/changelog.html">v1.7.0-stm32mp25-alpha-r1-rc3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cubeide/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Design Documents</a> &raquo;</li>
      <li>Mailbox NS Agent Design Update</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mailbox-ns-agent-design-update">
<h1>Mailbox NS Agent Design Update<a class="headerlink" href="#mailbox-ns-agent-design-update" title="Permalink to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">Organization</dt>
<dd class="field-odd"><p>Arm Limited</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p><a class="reference external" href="mailto:tf-m&#37;&#52;&#48;lists&#46;trustedfirmware&#46;org">tf-m<span>&#64;</span>lists<span>&#46;</span>trustedfirmware<span>&#46;</span>org</a></p>
</dd>
</dl>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading"></a></h2>
<p>The SPE component that maintains the non-secure clients’ request is called
‘NS Agent’ in TF-M. Besides the Trustzone-based isolation mechanism, there is
one other isolation mechanism that implements individual PEs in physically
isolated cores respectively. NSPE and SPE transfer non-secure client requests
via inter-processor communication based on mailboxes. The component that
handles inter-processor communication messages is called <code class="docutils literal notranslate"><span class="pre">mailbox</span> <span class="pre">NS</span> <span class="pre">Agent</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There may be hardware components and software solutions containing ‘mailbox’
in their names. The concept <code class="docutils literal notranslate"><span class="pre">mailbox</span></code> in this document represent the
mechanism described above, which is not referring to the external concepts.</p>
</div>
<p>When the first version <code class="docutils literal notranslate"><span class="pre">mailbox</span> <span class="pre">NS</span> <span class="pre">Agent</span></code> was introduced, the generic FFM
interrupt handling was not ready. Hence a customized solution
<code class="docutils literal notranslate"><span class="pre">Multiple</span> <span class="pre">Core</span></code> is implemented. This customized implementation:</p>
<ul class="simple">
<li><p>Perform customized operations on SPM internal data in a deferred interrupt
handler.</p></li>
<li><p>Process mailbox operations as special cases in SPM common logic.</p></li>
</ul>
<p>These behaviours couple SPM tightly with mailbox logic, which bring issues for
maintenance. To address the issue, an updated design shall:</p>
<ul class="simple">
<li><p>Make SPM manage other components in a unified way (For example, it is
simpler for SPM if all non-SPM components under the IPC model act as
<code class="docutils literal notranslate"><span class="pre">processes</span></code>.)</p></li>
<li><p>Can use FF-M compliant interrupt mechanism and APIs.</p></li>
</ul>
<p>Following the above guidelines makes the <code class="docutils literal notranslate"><span class="pre">mailbox</span> <span class="pre">NS</span> <span class="pre">agent</span></code> work like a
<code class="docutils literal notranslate"><span class="pre">partition</span></code>. The agent has an endless loop and waits for signals, calls FFM
API based on the parsing result on the communication messages. But there are
still issues after looking closer to the requirements of the agent:</p>
<ul class="simple">
<li><p>SPM treats FFM Client API caller’s ID as the client ID. While the mailbox NS
agent may represent multiple non-secure clients. Hence it needs to tell
SPM which non-secure client it is representing, and the default FFM Client
API does not have such capability.</p></li>
<li><p>FFM Client API blocks caller before the call is replied; while the
mailbox NS Agent needs to respond to the non-secure interrupts in time.
Blocking while waiting for a reply may cause the non-secure communication
message not to be handled in time.</p></li>
</ul>
<p>Extra design items need to be added to address the issues.</p>
</section>
<section id="design-update">
<h2>Design Update<a class="headerlink" href="#design-update" title="Permalink to this heading"></a></h2>
<p>The below figure shows the overall design to cover various component types.
NS Agents are the implementation-defined components that provide FF-M compliant
Client API to the non-secure clients. Hence from the view of the non-secure
clients, the FF-M client API behaviour follows the FF-M definition. And NS
Agent needs customization in SPM since it has extra requirements compared to
a generic secure partition.</p>
<figure class="align-center" id="fig-mailbox1">
<a class="reference internal image-reference" href="../../_images/mailbox_ns_agent1.svg"><img alt="../../_images/mailbox_ns_agent1.svg" src="../../_images/mailbox_ns_agent1.svg" width="70%" /></a>
<figcaption>
<p><span class="caption-number">Figure 4: </span><span class="caption-text">Component types and the callable API set</span><a class="headerlink" href="#fig-mailbox1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>3 non-SPM component types here: FFM-compliant Secure Partition
(aka <code class="docutils literal notranslate"><span class="pre">partition</span></code>), Trustzone-based NS Agent (aka <code class="docutils literal notranslate"><span class="pre">Trustzone</span> <span class="pre">NS</span> <span class="pre">agent</span></code>)
and mailbox-based NS Agent (aka <code class="docutils literal notranslate"><span class="pre">mailbox</span> <span class="pre">NS</span> <span class="pre">agent</span></code>).
<code class="docutils literal notranslate"><span class="pre">Trustzone</span> <span class="pre">NS</span> <span class="pre">agent</span></code> is mentioned here for the comparison purpose. The
implementation details for this NS agent type is not introduced here.</p>
</div>
<p>To make the programming model close to the FFM compliance, the
<code class="docutils literal notranslate"><span class="pre">mailbox</span> <span class="pre">NS</span> <span class="pre">agent</span></code> is designed as:</p>
<ul class="simple">
<li><p>Working like a standard Secure Partition under the IPC model, has one
single thread, can call FFM standard API.</p></li>
<li><p>Having a manifest file to describe the attributes and resources and a
positive valued <code class="docutils literal notranslate"><span class="pre">Partition</span> <span class="pre">ID</span></code> in the manifest.</p></li>
</ul>
<p>Services rely on the <code class="docutils literal notranslate"><span class="pre">client_id</span></code> to apply policy-checking, hence SPM
needs to know which <code class="docutils literal notranslate"><span class="pre">client_id</span></code> the mailbox NS Agent is representing when
mailbox API is calling Client API. The standard API treats the caller as the
client of the service, which means that an extended API is needed to support
identifying the non-secure client that is represented. SPM sets the
non-secure <code class="docutils literal notranslate"><span class="pre">client_id</span></code> into the message right at the moment the message is
going to be sent. Before this point, SPM performs the call based on the
agent’s ID.</p>
<p>These <code class="docutils literal notranslate"><span class="pre">Extended</span> <span class="pre">APIs</span></code> are non-blocking, unlike the standard FF-M Client
APIs. This can improve the communication efficiency between NS clients and
mailbox NS agents. With this mechanism, extra signals and APIs for message
acknowledges are also required.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A standard Secure Partition gets errors when calling the <code class="docutils literal notranslate"><span class="pre">Extended</span> <span class="pre">API</span></code>.</p>
</div>
<p>The secure mapped memory for mailbox communication is one of the agent’s
assets. As the agent has the capability to forward and represent non-secure
clients, it is the agent’s duty to identify the non-secure clients it is
representing.</p>
<section id="updated-programming-items">
<h3>Updated Programming Items<a class="headerlink" href="#updated-programming-items" title="Permalink to this heading"></a></h3>
<p>These Client APIs are the expansion based on the standard Client APIs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">agent_psa_connect</span></code> is extended from <code class="docutils literal notranslate"><span class="pre">psa_connect</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">agent_psa_call</span></code> is extended from <code class="docutils literal notranslate"><span class="pre">psa_call</span></code>.</p></li>
</ul>
<p>And to cooperate with the changed behaviour of these APIs, extra defined
signals and types are also involved.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Namespace <code class="docutils literal notranslate"><span class="pre">agent</span></code> is involved for NS Agent callable API; namespace <code class="docutils literal notranslate"><span class="pre">tfm</span></code>
is involved for TF-M specific concepts. Even though <code class="docutils literal notranslate"><span class="pre">agent</span></code> is TF-M
specific at the current stage, it is proposed to be a common concept for
general FF-M compliant implementations, hence assigning <code class="docutils literal notranslate"><span class="pre">agent</span></code> for
proposed API and data structures.</p>
</div>
</section>
<section id="agent-specific-client-api">
<h3>Agent-specific Client API<a class="headerlink" href="#agent-specific-client-api" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">agent_psa_connect</span></code> is the API added to support agent forwarding NS
requests.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">psa_handle_t</span><span class="w"> </span><span class="nf">agent_psa_connect</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">sid</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">version</span><span class="p">,</span>
<span class="w">                               </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">ns_client_id</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">client_data</span><span class="p">);</span>
</pre></div>
</div>
<p>One extra parameter <code class="docutils literal notranslate"><span class="pre">ns_client_id</span></code> added to tell SPM which NS client the
agent is representing when API gets called. It is recorded in the handle
association data in SPM and requires to be a negative value; ZERO or positive
values are invalid non-secure client IDs, SPM does not use these invalid IDs
in the message. Instead, it puts the agent’s ID into the messaging in this
case. This mechanism can provide chances for the agents calling APIs for their
own service accessing and API works asynchronously.</p>
<p>As mentioned, the standard FFM Client service accessing API are blocked until
the IPC message gets replied to. This API returns immediately without waiting
for acknowledgement. A <code class="docutils literal notranslate"><span class="pre">psa_handle_t</span></code> is allocated and returned if no error
occurred because a unique value is needed to help the agent manage the
non-secure clients and the requests. The subsequent <code class="docutils literal notranslate"><span class="pre">agent_psa_call</span></code>
or <code class="docutils literal notranslate"><span class="pre">agent_psa_close</span></code> with this allocated but not acknowledged handle gets
an <code class="docutils literal notranslate"><span class="pre">In</span> <span class="pre">progress</span></code> status code.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">psa_invec</span><span class="w">     </span><span class="n">in_vecs</span><span class="p">[</span><span class="n">PSA_MAX_IOVEC</span><span class="p">];</span>
<span class="w">    </span><span class="n">psa_outvec</span><span class="w">    </span><span class="n">out_vecs</span><span class="p">[</span><span class="n">PSA_MAX_IOVEC</span><span class="p">];</span>
<span class="p">}</span><span class="w"> </span><span class="n">client_vectors_t</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">ns_client_id</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w">    </span><span class="o">*</span><span class="n">client_data</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">client_param_t</span><span class="p">;</span>

<span class="n">psa_status_t</span><span class="w"> </span><span class="nf">agent_psa_call</span><span class="p">(</span><span class="n">psa_handle_t</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">type</span><span class="p">,</span>
<span class="w">                            </span><span class="n">client_vectors_t</span><span class="w"> </span><span class="o">*</span><span class="n">vecs</span><span class="p">,</span><span class="w"> </span><span class="n">client_param_t</span><span class="w"> </span><span class="o">*</span><span class="n">params</span><span class="p">);</span>
</pre></div>
</div>
<p>Compared to the standard <code class="docutils literal notranslate"><span class="pre">psa_call</span></code>, this API:</p>
<ul class="simple">
<li><p>Is asynchronous.</p></li>
<li><p>Squashes the <code class="docutils literal notranslate"><span class="pre">psa_invec_t</span></code> and <code class="docutils literal notranslate"><span class="pre">psa_outvec_t</span></code> into a new composited
parameter <code class="docutils literal notranslate"><span class="pre">vecs</span></code> to make the ABI APCS compliant.</p></li>
<li><p>one extra parameter <code class="docutils literal notranslate"><span class="pre">params</span></code> for <code class="docutils literal notranslate"><span class="pre">agent_psa_call</span></code> stands for the
auxiliary data added. This member is ignored for connection-based services
because <code class="docutils literal notranslate"><span class="pre">agent_psa_connect</span></code> already assigned one hence this member is for
stateless services only. And the same, ZERO or positive values are ignored
during the <code class="docutils literal notranslate"><span class="pre">agent_psa_call</span></code> lifecycle.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For stateless services, a temporary <code class="docutils literal notranslate"><span class="pre">psa_handle_t</span></code> is allocated and
returned. This handle is freed after the agent read the acknowledgement by
<code class="docutils literal notranslate"><span class="pre">psa_get</span></code>. This is also introduced in the subsequent introduction on
<a class="reference internal" href="#agent-specific-signal">Agent-specific signal</a>.</p>
</div>
</section>
<section id="agent-specific-signal">
<h3>Agent-specific signal<a class="headerlink" href="#agent-specific-signal" title="Permalink to this heading"></a></h3>
<p>To cooperate with the agent-specific API, one extra acknowledgement signal is
defined:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PSA_MSG_ACK            (0x00000004u)</span>
</pre></div>
</div>
<p>This signal can be sent to agent type component only. An agent can call
<code class="docutils literal notranslate"><span class="pre">psa_get</span></code> with this signal to get one acknowledged message. This signal is
cleared when all queued messages for the agent have been retrieved using
<code class="docutils literal notranslate"><span class="pre">psa_get</span></code>. SPM assembles the information into agent provided message object.
For the stateless handle, the internal handle object is freed after this
<code class="docutils literal notranslate"><span class="pre">psa_get</span></code> call. The agent can know what kind of message is acknowledged by
the <code class="docutils literal notranslate"><span class="pre">type</span></code> member in the <code class="docutils literal notranslate"><span class="pre">psa_msg_t</span></code>, and the <code class="docutils literal notranslate"><span class="pre">client_data</span></code> passed in is
put in member <code class="docutils literal notranslate"><span class="pre">rhandle</span></code>. If no ‘PSA_MSG_ACK’ signals pending, calling
<code class="docutils literal notranslate"><span class="pre">psa_get</span></code> gets an state representing <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">ready</span></code> to the caller. This
state is to be defined.</p>
</section>
<section id="code-example">
<h3>Code Example<a class="headerlink" href="#code-example" title="Permalink to this heading"></a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * The actual implementation can change this __customized_t freely, or</span>
<span class="cm"> * discard this type and apply some in-house mechanism - the example</span>
<span class="cm"> * here is to introduce how an agent works only.</span>
<span class="cm"> */</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">__customized_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w">      </span><span class="n">type</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w">      </span><span class="n">client_id</span><span class="p">;</span>
<span class="w">    </span><span class="n">psa_handle_t</span><span class="w"> </span><span class="n">handle</span><span class="p">;</span>
<span class="w">    </span><span class="n">psa_handle_t</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">mailbox_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">psa_signal_t</span><span class="w">   </span><span class="n">signals</span><span class="p">;</span>
<span class="w">    </span><span class="n">psa_status_t</span><span class="w">   </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="n">psa_msg_t</span><span class="w">      </span><span class="n">msg</span><span class="p">;</span>
<span class="w">    </span><span class="n">client_param_t</span><span class="w"> </span><span class="n">client_param</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">__customized_t</span><span class="w"> </span><span class="n">ns_msg</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">signals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">psa_wait</span><span class="p">(</span><span class="n">ALL</span><span class="p">,</span><span class="w"> </span><span class="n">BLOCK</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signals</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">MAILBOX_INTERRUPT_SIGNAL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/* NS memory check needs to be performed. */</span>
<span class="w">            </span><span class="n">__customized_platform_get_mail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ns_msg</span><span class="p">);</span>

<span class="w">            </span><span class="cm">/*</span>
<span class="cm">             * MACRO &#39;SID&#39;, &#39;VER&#39;, &#39;NSID&#39; and &#39;VECTORS&#39; represents necessary</span>
<span class="cm">             * information extraction from &#39;ns_msg&#39;, put MACRO names here</span>
<span class="cm">             * and leave the details to the implementation.</span>
<span class="cm">             */</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ns_msg</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PSA_IPC_CONNECT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agent_psa_connect</span><span class="p">(</span><span class="n">SID</span><span class="p">(</span><span class="n">ns_msg</span><span class="p">),</span><span class="w"> </span><span class="n">VER</span><span class="p">(</span><span class="n">ns_msg</span><span class="p">),</span>
<span class="w">                                                  </span><span class="n">NSID</span><span class="p">(</span><span class="n">ns_msg</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ns_msg</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ns_msg</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">PSA_IPC_CLOSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">psa_close</span><span class="p">(</span><span class="n">ns_msg</span><span class="p">.</span><span class="n">handle</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="cm">/* Other types as call type and let API check errors. */</span>
<span class="w">                </span><span class="n">client_param</span><span class="p">.</span><span class="n">ns_client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">client_id</span><span class="p">;</span>
<span class="w">                </span><span class="n">client_param</span><span class="p">.</span><span class="n">client_data</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ns_msg</span><span class="p">;</span>

<span class="w">                </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">agent_psa_call</span><span class="p">(</span><span class="n">ns_msg</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">type</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">VECTORS</span><span class="p">(</span><span class="n">ns_msg</span><span class="p">),</span>
<span class="w">                                               </span><span class="o">&amp;</span><span class="n">client_param</span><span class="p">);</span>
<span class="w">                </span><span class="cm">/* Handle the stateless service case. */</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ns_msg</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                    </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">PSA_ERROR_IN_PROGRESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">psa_handle_t</span><span class="p">)</span><span class="n">ns_msg</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signals</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">PSA_MSG_ACK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/* The handle is freed for stateless service after &#39;psa_get&#39;. */</span>
<span class="w">            </span><span class="n">status</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">psa_get</span><span class="p">(</span><span class="n">PSA_MSG_ACK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<span class="w">            </span><span class="n">ms_msg</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">rhandle</span><span class="p">;</span>
<span class="w">            </span><span class="n">ns_msg</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">            </span><span class="n">__customized_platform__send_mail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ns_msg</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">__customized*</span></code> API are implementation-specific APIs to be implemented by
the mailbox Agent developer.</p>
</div>
<hr class="docutils" />
<p><em>Copyright (c) 2022, Arm Limited. All rights reserved.</em></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>