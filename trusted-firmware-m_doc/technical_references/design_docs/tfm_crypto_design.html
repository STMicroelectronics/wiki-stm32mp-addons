<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto Service design &mdash; Trusted Firmware-M v1.7.0-stm32mp25-alpha-r1-rc3-doc documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Firmware Update Service" href="tfm_fwu_service.html" />
    <link rel="prev" title="Cooperative Scheduling Rules" href="tfm_cooperative_scheduling_rules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Trusted Firmware-M
            <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v1.7.0-stm32mp25-alpha-r1-rc3-doc

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/index.html">Threat Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Trusted Firmware-M Generic Threat Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.7.0.html">v1.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.1.html">v1.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.0.html">v1.6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.5.0.html">v1.5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platform Selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an547/README.html">Corstone-300 FPGA (AN547)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an552/README.html">Corstone-300 FPGA and FVP (AN552)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rss/readme.html">Runtime Security Subsystem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">Cypress PSoC64</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/cypress_psoc64_spec.html">Cypress PSoC64 Specifics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/README.html">Core Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/RELEASE.html">Core Library Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">Nordic nRF5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">Nordic nRF9160</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">Laird Connectivity BL5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/profiles/index.html">Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_medium.html"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration/profiles/tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_guide/index.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_folder.html">Details for the platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_ext_folder.html">Details for the platform/ext folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/porting_TFM_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/services/index.html">Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html">Internal Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_secure_partition_addition.html">Adding a New Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_manifest_tool_user_guide.html">The manifest tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design Documents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dual-cpu/index.html">Dual-CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/booting_a_dual_core_system.html">Booting a Dual-Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">Communication Prototype Between NSPE And SPE In Dual Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox Design in TF-M on Dual-core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="dual-cpu/tfm_multi_core_access_check.html">Memory Access Check of Trusted Firmware-M in Multi-Core Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_sharing.html">Code sharing between independently linked XIP binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="enum_implicit_casting.html">Fixing implicit casting for C enumeration values</a></li>
<li class="toctree-l2"><a class="reference internal" href="ff_isolation.html">FF-M Isolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailbox_ns_agent_update.html">Mailbox NS Agent Design Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="ps_key_management.html">Protected Storage service key management</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_boot_hw_key_integration.html">HW crypto key integration in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_boot_rollback_protection.html">Rollback protection in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_structure.html">Trusted Firmware-M Source Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="stateless_rot_service.html">Stateless Root of Trust Services Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="symmetric_initial_attest.html">Symmetric key algorithm based Initial Attestation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_builtin_keys.html">TF-M builtin keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_code_generation_with_jinja2.html">Code Generation With Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_cooperative_scheduling_rules.html">Cooperative Scheduling Rules</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Crypto Service design</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_fwu_service.html">Firmware Update Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_its_512_flash.html">Add support for block-aligned flash in Internal Trusted Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_its_service.html">Internal Trusted Storage (ITS) Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_log_system_design_document.html">Log system design document</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_physical_attack_mitigation.html">Physical attack mitigation in Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_psa_inter_process_communication.html">TF-M Inter-Process Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_secure_boot.html">Secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_secure_partition_runtime_library.html">Secure Partition Runtime Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="tfm_uniform_secure_service_signature.html">Uniform Secure Service Signature</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/view/TF-M/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0-stm32mp25-alpha-r1-rc3/changelog.html">v1.7.0-stm32mp25-alpha-r1-rc3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cubeide/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Design Documents</a> &raquo;</li>
      <li>Crypto Service design</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="crypto-service-design">
<h1><a class="toc-backref" href="#id7">Crypto Service design</a><a class="headerlink" href="#crypto-service-design" title="Permalink to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Antonio de Angelis</p>
</dd>
<dt class="field-even">Organization</dt>
<dd class="field-even"><p>Arm Limited</p>
</dd>
<dt class="field-odd">Contact</dt>
<dd class="field-odd"><p>Antonio de Angelis &lt;<a class="reference external" href="mailto:antonio&#46;deangelis&#37;&#52;&#48;arm&#46;com">antonio<span>&#46;</span>deangelis<span>&#64;</span>arm<span>&#46;</span>com</a>&gt;</p>
</dd>
</dl>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#crypto-service-design" id="id7">Crypto Service design</a></p>
<ul>
<li><p><a class="reference internal" href="#abstract" id="id8">Abstract</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id9">Introduction</a></p></li>
<li><p><a class="reference internal" href="#components" id="id10">Components</a></p></li>
<li><p><a class="reference internal" href="#service-api-description" id="id11">Service API description</a></p></li>
<li><p><a class="reference internal" href="#configuration-parameters" id="id12">Configuration parameters</a></p></li>
<li><p><a class="reference internal" href="#references" id="id13">References</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="abstract">
<h2><a class="toc-backref" href="#id8">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this heading"></a></h2>
<p>This document describes the design of the TF-M Cryptographic Secure Service
(in short, TF-M Crypto service).</p>
</section>
<section id="introduction">
<h2><a class="toc-backref" href="#id9">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>The TF-M Crypto service provides an implementation of the PSA Crypto API
in a PSA RoT secure partition in TF-M. It is based on Mbed Crypto, which
is a reference implementation of the PSA Crypto API. For more details on
the PSA Crypto API or the Mbed Crypto implementation, please refer
directly to the <code class="docutils literal notranslate"><span class="pre">mbed-crypto</span></code> GitHub repository <a class="footnote-reference brackets" href="#id2" id="id1">1</a> .</p>
<p>The service can be used by other services running in the SPE, or by
applications running in the NSPE, to provide cryptographic
functionalities.</p>
</section>
<section id="components">
<h2><a class="toc-backref" href="#id10">Components</a><a class="headerlink" href="#components" title="Permalink to this heading"></a></h2>
<p>The TF-M Crypto service is implemented by a number of different software
components, which are listed below:</p>
<table class="colwidths-auto docutils align-default" id="id3">
<caption><span class="caption-number">Table 44: </span><span class="caption-text">Components table</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Component name</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Location</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client API interface</p></td>
<td><p>This module exports the client API of PSA Crypto to the users.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./interface/src/tfm_crypto_api.c</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Mbed Crypto</p></td>
<td><p>The Mbed Crypto library is used in the service as a
cryptographic library exposing the PSA Crypto API interface.</p></td>
<td><p>Needed as dependency at the same level of the TF-M folder,
i.e. <code class="docutils literal notranslate"><span class="pre">../mbed-crypto</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Init module</p></td>
<td><p>This module handles the initialisation of the service objects
during TF-M boot and provides the infrastructure to service
requests when TF-M is built for IPC model.
The dispatching mechanism of IPC requests is based on a look
up table of function pointers.
This design allows for better scalability and support of a
higher number of Secure functions with minimal overhead and
duplication of code.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_init.c</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Alloc module</p></td>
<td><p>This module handles the allocation of contexts for multipart
operations in the Secure world.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_alloc.c</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Service modules</p></td>
<td><p>These modules (AEAD, Asymmetric, Cipher, Key Deriv, Hash, Key,
MAC) represent a thin layer which is in charge of servicing
the calls from the SPE/NSPE client API interfaces.
They provide parameter sanitation and context retrieval for
multipart operations, and dispatching to the corresponding
library function exposed by Mbed Crypto for the desired
functionality.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_aead.c</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_asymmetric.c</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_cipher.c</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_key_derivation.c</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_hash.c</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_key.c</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/crypto_mac.c</span></code>
‘’./secure_fw/partitions/crypto/crypto_key_management.c’’</p></td>
</tr>
<tr class="row-odd"><td><p>Manifest</p></td>
<td><p>The manifest file is a description of the service components.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/manifest.yaml</span></code></p></td>
</tr>
<tr class="row-even"><td><p>CMake files and headers</p></td>
<td><p>The CMake files are used by the TF-M CMake build system to
build the service as part of the Secure FW build. The service
is built as a static library (<code class="docutils literal notranslate"><span class="pre">tfm_crypto.a</span></code>).
The build system allows to build as well the Mbed Crypto
library as part of the Secure FW build process and archive it
with the static library of the Crypto service.
The headers are used to export the public prototypes of the
functions in the Service modules <code class="docutils literal notranslate"><span class="pre">tfm_crypto_api.h</span></code>, and
to provide the necessary defines (i.e. <code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_SIG</span></code>).
In particular <code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_SIG</span></code> identifies the signal on
which the service handler waits for requests when the service
is built for IPC model.
The header available in the interface, <code class="docutils literal notranslate"><span class="pre">tfm_crypto_defs.h</span></code>
, contains types and defines for building the NSPE interface
as part of a Non-Secure application.
Finally, the <code class="docutils literal notranslate"><span class="pre">crypto_spe.h</span></code> header is used during the
build of the Mbed Crypto library, when the Mbed Crypto config
option <code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_SPM</span></code> is defined, to add a
custom prefix to the PSA API symbols  so that duplication of
symbol names is avoided.
The prefix used for the PSA API symbols of the Mbed Crypto
library is chosen to be <code class="docutils literal notranslate"><span class="pre">mbedcrypto__</span></code>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/CMakeLists.inc</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/CMakeLists.txt</span></code>
<code class="docutils literal notranslate"><span class="pre">./interface/include/tfm_crypto_defs.h</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/tfm_crypto_api.h</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/tfm_crypto_signal.h</span></code>
<code class="docutils literal notranslate"><span class="pre">./secure_fw/partitions/crypto/spe_crypto.h</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Documentation</p></td>
<td><p>The integration guide contains the description of the TF-M
Crypto service modules and interfaces.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./user_guides/services/tfm_crypto_integration_guide.rst</span></code></p></td>
</tr>
</tbody>
</table>
<p>The interaction between the different components is described by the
following block diagram:</p>
<figure class="align-default" id="id4">
<img alt="../../_images/tfm_crypto_design.png" src="../../_images/tfm_crypto_design.png" />
<figcaption>
<p><span class="caption-number">Figure 17: </span><span class="caption-text">Block diagram of the different components of the TF-M Crypto service. A
dotted line is used to indicate the interaction with a library.</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Note: in IPC model, the interaction between components is slightly
different, as the Service modules are not called directly through the
TF-M Secure Partition Manager but through the IPC handler which resides
in the Init module.</p>
</section>
<section id="service-api-description">
<h2><a class="toc-backref" href="#id11">Service API description</a><a class="headerlink" href="#service-api-description" title="Permalink to this heading"></a></h2>
<p>Most of the APIs exported by the TF-M Crypto service (i.e. from the Service
modules) have a direct correspondence with the PSA Crypto API. The Alloc and
Init modules instead export some APIs which are specific to the TF-M Crypto
service, and are available only to the Service modules or the SPM. For a
detailed description of the prototypes please refer to the <code class="docutils literal notranslate"><span class="pre">tfm_crypto_api.h</span></code>
header.</p>
<table class="colwidths-auto docutils align-default" id="id5">
<caption><span class="caption-number">Table 45: </span><span class="caption-text">Init and Alloc modules APIs</span><a class="headerlink" href="#id5" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Function</strong></p></th>
<th class="head"><p><strong>Module</strong></p></th>
<th class="head"><p><strong>Caller</strong></p></th>
<th class="head"><p><strong>Scope</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tfm_crypto_init()</p></td>
<td><p>Init</p></td>
<td><p>SPM</p></td>
<td><p>Called during TF-M boot for initialisation. In IPC
model, it calls the IPC service request handler.</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_crypto_init_alloc()</p></td>
<td><p>Alloc</p></td>
<td><p>Init</p></td>
<td><p>Called by tfm_crypto_init(), it initialises the
concurrent operation contexts storage area.</p></td>
</tr>
<tr class="row-even"><td><p>tfm_crypto_operation_alloc()</p></td>
<td><p>Alloc</p></td>
<td><p>Service modules</p></td>
<td><p>It allocates a new operation context for a multipart
operation. It returns an handle to the allocated
context in secure memory.</p></td>
</tr>
<tr class="row-odd"><td><p>tfm_crypto_operation_lookup()</p></td>
<td><p>Alloc</p></td>
<td><p>Service modules</p></td>
<td><p>It retrieves a previously allocated operation context
of a multipart operation, based on the handle given
as input.</p></td>
</tr>
<tr class="row-even"><td><p>tfm_crypto_operation_release()</p></td>
<td><p>Alloc</p></td>
<td><p>Service modules</p></td>
<td><p>It releases a previously allocated operation context
of a multipart operation, based on the handle given
as input.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-parameters">
<h2><a class="toc-backref" href="#id12">Configuration parameters</a><a class="headerlink" href="#configuration-parameters" title="Permalink to this heading"></a></h2>
<p>The TF-M Crypto service exposes some configuration parameters to tailor
the service configuration in terms of supported functionalities and
hence FLASH/RAM size to meet the requirements of different platforms and
use cases. These parameters can be provided via CMake parameters during
the CMake configuration step and as a configuration header to allow the
configuration of the Mbed Crypto library.</p>
<table class="colwidths-auto docutils align-default" id="id6">
<caption><span class="caption-number">Table 46: </span><span class="caption-text">Configuration parameters table</span><a class="headerlink" href="#id6" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>Scope</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CRYPTO_ENGINE_BUF_SIZE</span></code></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>Buffer used by Mbed Crypto for its own allocations at runtime.
This is a buffer allocated in static memory.</p></td>
<td><p>To be configured based on the desired
use case and application requirements.</p></td>
<td><p>8096 (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CRYPTO_CONC_OPER_NUM</span></code></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>This parameter defines the maximum number of possible
concurrent operation contexts (cipher, MAC, hash and key deriv)
for multi-part operations, that can be allocated simultaneously
at any time.</p></td>
<td><p>To be configured based on the desire
use case and platform requirements.</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CRYPTO_IOVEC_BUFFER_SIZE</span></code></p></td>
<td><p>CMake build
configuration parameter</p></td>
<td><p>This parameter applies only to IPC model builds. In IPC model,
during a Service call, input and outputs are allocated
temporarily in an internal scratch buffer whose size is
determined by this parameter.</p></td>
<td><p>To be configured based on the desired
use case and application requirements.</p></td>
<td><p>5120 (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MBEDTLS_CONFIG_FILE</span></code></p></td>
<td><p>Configuration header</p></td>
<td><p>The Mbed Crypto library can be configured to support different
algorithms through the usage of a a configuration header file
at build time. This allows for tailoring FLASH/RAM requirements
for different platforms and use cases.</p></td>
<td><p>To be configured based on the
application and platform requirements.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./lib/ext/mbedcrypto/mbedcrypto_config/tfm_mbedcrypto_config_default.h</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MBEDTLS_PSA_CRYPTO_CONFIG_FILE</span></code></p></td>
<td><p>Configuration header</p></td>
<td><p>This header file specifies which cryptographic mechanisms are
available through the PSA API when #MBEDTLS_PSA_CRYPTO_CONFIG
is enabled, and is not used when #MBEDTLS_PSA_CRYPTO_CONFIG is
disabled.</p></td>
<td><p>To be configured based on the
application and platform requirements.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./lib/ext/mbedcrypto/mbedcrypto_config/crypto_config_default.h</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id13">References</a><a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">mbed-crypto</span></code> repository which holds the PSA Crypto API specification and the Mbed Crypto reference implementation: <a class="reference external" href="https://github.com/Mbed-TLS">https://github.com/Mbed-TLS</a></p>
</dd>
</dl>
<hr class="docutils" />
<p><em>Copyright (c) 2019-2022, Arm Limited. All rights reserved.</em></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>