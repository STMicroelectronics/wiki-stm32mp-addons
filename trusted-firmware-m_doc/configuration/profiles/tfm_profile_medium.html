<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trusted Firmware-M Profile Medium Design &mdash; Trusted Firmware-M v1.7.0-stm32mp25-alpha-r1-rc3-doc documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/tfm_custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Trusted Firmware-M Profile Large Design" href="tfm_profile_large.html" />
    <link rel="prev" title="Trusted Firmware-M Profile Medium-ARoT-less" href="tfm_profile_medium_arot-less.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Trusted Firmware-M
            <img src="../../_static/tf_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v1.7.0-stm32mp25-alpha-r1-rc3-doc

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/stack_seal_vulnerability.html">Advisory TFMV-1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/svc_caller_sp_fetching_vulnerability.html">Advisory TFMV-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/crypto_multi_part_ops_abort_fail.html">Advisory TFMV-3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/profile_small_key_id_encoding_vulnerability.html">Advisory TFMV-4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../security/security_advisories/fwu_write_vulnerability.html">Advisory TFMV-5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/threat_models/index.html">Threat Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/threat_models/generic_threat_model.html">Trusted Firmware-M Generic Threat Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/security.html">Security Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.7.0.html">v1.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.1.html">v1.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.6.0.html">v1.6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/1.5.0.html">v1.5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../releases/release_process.html">Release Cadence and Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../platform/index.html">Platform Selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platform/arm/index.html">Arm platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/corstone1000/readme.html">Corstone-1000</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an547/README.html">Corstone-300 FPGA (AN547)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/an552/README.html">Corstone-300 FPGA and FVP (AN552)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/mps3/corstone310/README.html">Corstone-310 FVP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_b1/readme.html">Musca-B1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/musca_s1/readme.html">Musca-S1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/arm/rss/readme.html">Runtime Security Subsystem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nxp/lpcxpresso55s69/README.html">LPCXpresso55S69</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/cypress/psoc64/index.html">Cypress PSoC64</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/cypress_psoc64_spec.html">Cypress PSoC64 Specifics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/README.html">Core Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/cypress/psoc64/libs/core-lib/RELEASE.html">Core Library Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/stm/index.html">STMICROELECTRONICS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf5340dk_nrf5340_cpuapp/README.html">Nordic nRF5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nordic_nrf/nrf9160dk_nrf9160/README.html">Nordic nRF9160</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/lairdconnectivity/bl5340_dvk_cpuapp/README.html">Laird Connectivity BL5340</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2351/README.html">NuMaker-PFM-M2351</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platform/nuvoton/m2354/README.html">NuMaker-PFM-M2354</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/tfm_build_instruction.html">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../building/run_tfm_examples_on_arm_platforms.html">Run TF-M examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/documentation_generation.html">Building the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../building/tfm_build_instruction_iar.html">IAR toolchain</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../build_configuration.html">Build configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../header_file_system.html">Component configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig_system.html">Kconfig</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Profiles</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tfm_profile_small.html"> Small</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_profile_medium_arot-less.html"> ARoT-less</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#"> Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="tfm_profile_large.html"> Large</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../test_configuration.html">Tests configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_guide/index.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/spm_backends.html">SPM Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/non-secure_client_extension_integration_guide.html">NS client integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/os_migration_guide_armv8m.html">OS migration to Armv8-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_fpu_support.html">Floating-Point Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/tfm_secure_irq_integration_guide.html">Secure Interrupt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/platform/index.html">Adding a new platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_folder.html">Details for the platform folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_ext_folder.html">Details for the platform/ext folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/porting_TFM_to_a_new_hardware.html">Porting TF-M to a New Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_provisioning.html">Platform Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/platform/platform_deprecation.html">Platform deprecation and removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../integration_guide/services/index.html">Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_attestation_integration_guide.html">Initial Attestation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_crypto_integration_guide.html">Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html">Internal Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_platform_integration_guide.html">Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_ps_integration_guide.html">Protected Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_secure_partition_addition.html">Adding a New Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../integration_guide/services/tfm_manifest_tool_user_guide.html">The manifest tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../technical_references/design_docs/index.html">Design Documents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/index.html">Dual-CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/booting_a_dual_core_system.html">Booting a Dual-Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/communication_prototype_between_nspe_and_spe_in_dual_core_systems.html">Communication Prototype Between NSPE And SPE In Dual Core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/mailbox_design_on_dual_core_system.html">Mailbox Design in TF-M on Dual-core System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../technical_references/design_docs/dual-cpu/tfm_multi_core_access_check.html">Memory Access Check of Trusted Firmware-M in Multi-Core Topology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/bl1.html">BL1 Immutable bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/code_sharing.html">Code sharing between independently linked XIP binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/enum_implicit_casting.html">Fixing implicit casting for C enumeration values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/ff_isolation.html">FF-M Isolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/hardware_abstraction_layer.html">Hardware Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/mailbox_ns_agent_update.html">Mailbox NS Agent Design Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/ps_key_management.html">Protected Storage service key management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/secure_boot_hw_key_integration.html">HW crypto key integration in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/secure_boot_rollback_protection.html">Rollback protection in TF-M secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/secure_partition_manager.html">Secure Partition Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/source_structure.html">Trusted Firmware-M Source Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/stateless_rot_service.html">Stateless Root of Trust Services Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/symmetric_initial_attest.html">Symmetric key algorithm based Initial Attestation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_builtin_keys.html">TF-M builtin keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_code_generation_with_jinja2.html">Code Generation With Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_cooperative_scheduling_rules.html">Cooperative Scheduling Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_crypto_design.html">Crypto Service design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_fwu_service.html">Firmware Update Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_its_512_flash.html">Add support for block-aligned flash in Internal Trusted Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_its_service.html">Internal Trusted Storage (ITS) Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_log_system_design_document.html">Log system design document</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_physical_attack_mitigation.html">Physical attack mitigation in Trusted Firmware-M</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_psa_inter_process_communication.html">TF-M Inter-Process Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_secure_boot.html">Secure boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_secure_partition_runtime_library.html">Secure Partition Runtime Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../technical_references/design_docs/tfm_uniform_secure_service_signature.html">Uniform Secure Service Signature</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contributing_process.html">The process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/code_review_guide.html">Code review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html">Maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/maintainers.html#code-owners">Code owners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/coding_guide.html">Yet another coding standard :)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/doc_guidelines.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/tfm_design_proposal_guideline.html">Design proposal</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/lic.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/dco.html">DCO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://ci.trustedfirmware.org/view/TF-M/job/tf-m-build-docs-nightly/lastSuccessfulBuild/artifact/trusted-firmware-m/build/docs/reference_manual/html/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developer.trustedfirmware.org/w/collaboration/security_center">Security Center</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.arm.com/architecture/security-features/platform-security">PSA</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STMICROELECTRONICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stm/releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/getting_started.html">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/b_u585i_iot02a/readme.html">B-U585I-IOT02A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/platforms.html">Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32l5xx/readme.html">STM32L5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32mp2/readme.html">STM32MP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/common/stm32u5xx/readme.html">STM32U5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/nucleo_l552ze_q/readme.html">NUCLEO-L552ZE-Q</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32l562e_dk/readme.html">STM32L562E-DK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platform/stm/stm32mp257f_ev1/readme.html">stm32mp257f_ev1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/releases/changelog.html">Change Log &amp; Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/releases/v1.7.0-stm32mp25-alpha-r1-rc3/changelog.html">v1.7.0-stm32mp25-alpha-r1-rc3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/technical/index.html">Technical references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/a35_td_flavor/index.html">A35-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/a35_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/m33_td_flavor/index.html">M33-TD flavor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/memory_layout.html">Memory layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/m33_td_flavor/storage.html">Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/devicetree/index.html">Devicetree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html">Scope and purpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#concept">Concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../stm/technical/devicetree/devicetree_tfm.html#how-to-add-device">How to add device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initlevel.html">Initlevel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/initial_attestation.html">Initial Attestation Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stm/technical/nv_counter.html">Nv counter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stm/ide/index.html">Ide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stm/ide/cubeide/stm32cubeide.html">STM32CubeIDE</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Trusted Firmware-M</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Configuration</a> &raquo;</li>
          <li><a href="index.html">TF-M Profiles</a> &raquo;</li>
      <li>Trusted Firmware-M Profile Medium Design</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="trusted-firmware-m-profile-medium-design">
<h1>Trusted Firmware-M Profile Medium Design<a class="headerlink" href="#trusted-firmware-m-profile-medium-design" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>Compared with Profile Small, Profile Medium aims to securely connect devices to
Cloud services with asymmetric cipher support.
Profile Medium target devices need more resources for more cipher algorithms
and higher isolation levels.</p>
</section>
<section id="overall-design">
<h2>Overall design<a class="headerlink" href="#overall-design" title="Permalink to this heading"></a></h2>
<p>TF-M Profile Medium defines the following feature set:</p>
<blockquote>
<div><ul>
<li><p>Firmware Framework</p>
<blockquote>
<div><ul class="simple">
<li><p>Inter-Process Communication (IPC) model <a class="reference internal" href="#psa-ff-m" id="id1"><span>[PSA-FF-M]</span></a></p></li>
<li><p>Isolation level 2 <a class="reference internal" href="#psa-ff-m" id="id2"><span>[PSA-FF-M]</span></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Internal Trusted Storage (ITS)</p></li>
<li><p>Crypto</p>
<blockquote>
<div><ul>
<li><p>Support both symmetric cryptography and asymmetric cryptography</p></li>
<li><p>Asymmetric key based cipher suite suggested in TLS/DTLS profiles for
IoT <a class="reference internal" href="#rfc7925" id="id3"><span>[RFC7925]</span></a> and CoAP <a class="reference internal" href="#rfc7252" id="id4"><span>[RFC7252]</span></a>, including</p>
<blockquote>
<div><ul class="simple">
<li><p>Authenticated Encryption with Associated Data (AEAD) algorithm</p></li>
<li><p>Asymmetric key algorithm based signature and verification</p></li>
<li><p>Public-key cryptography based key exchange</p></li>
<li><p>Hash function</p></li>
<li><p>HMAC for default Pseudorandom Function (PRF)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Asymmetric digital signature and verification for Initial Attestation
Token (IAT)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Initial Attestation</p>
<blockquote>
<div><ul class="simple">
<li><p>Asymmetric key algorithm based Initial Attestation</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Lightweight boot</p>
<blockquote>
<div><ul class="simple">
<li><p>Anti-rollback protection</p></li>
<li><p>Multiple image boot</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Protected Storage (PS) if off-chip storage device is integrated</p>
<blockquote>
<div><ul class="simple">
<li><p>Data confidentiality</p></li>
<li><p>Data integrity</p></li>
<li><p>Rollback protection</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</section>
<section id="design-details">
<h2>Design details<a class="headerlink" href="#design-details" title="Permalink to this heading"></a></h2>
<p>More details of TF-M Profile Medium design are described in following sections.</p>
<section id="firmware-framework">
<h3>Firmware framework<a class="headerlink" href="#firmware-framework" title="Permalink to this heading"></a></h3>
<p>Profile Medium with IPC model and isolation level 2 aims to support usage
scenarios which require more complicated secure service model and additional
protection to PSA RoT.</p>
<section id="level-2-isolation">
<h4>Level 2 isolation<a class="headerlink" href="#level-2-isolation" title="Permalink to this heading"></a></h4>
<p>Profile Medium selects isolation level 2 by default. In addition to isolation
level 1, the PSA Root of Trust (PSA RoT) is also protected from access by the
Application Root of Trust (App RoT) in level 2 isolation.</p>
</section>
<section id="ipc-model">
<h4>IPC model<a class="headerlink" href="#ipc-model" title="Permalink to this heading"></a></h4>
<p>Profile Medium enables IPC model by default. IPC model can achieve a more
flexible framework and higher levels of isolation, but may require more memory
footprint and bring in longer latency, compared to SFN model.</p>
<p>TF-M IPC model implementation follows the PSA Firmware Framework for M
(PSA-FF-M) <a class="reference internal" href="#psa-ff-m" id="id5"><span>[PSA-FF-M]</span></a>.</p>
</section>
</section>
<section id="crypto-service">
<h3>Crypto service<a class="headerlink" href="#crypto-service" title="Permalink to this heading"></a></h3>
<p>Compared to Profile Small, Profile Medium includes asymmetric cryptography to
support direct connection to Cloud services via common protocols, such as
TLS/DTLS 1.2.</p>
<p>As suggested in CoAP <a class="reference internal" href="#rfc7252" id="id6"><span>[RFC7252]</span></a> and <a class="reference internal" href="#rfc7925" id="id7"><span>[RFC7925]</span></a>, TF-M Profile Medium by default
selects <code class="docutils literal notranslate"><span class="pre">TLS_ECDHE_ECDSA_WITH_AES_128_CCM</span></code> as reference, which requires:</p>
<blockquote>
<div><ul class="simple">
<li><p>ECDHE_ECDSA as key exchange algorithm.</p></li>
<li><p>AES-128-CCM (AES CCM mode with 128-bit key) as AEAD algorithm.
Platforms can implement AES-128-CCM with truncated authentication tag to
achieve less network bandwidth <a class="reference internal" href="#rfc7925" id="id8"><span>[RFC7925]</span></a>.</p></li>
<li><p>SHA256 as Hash function.</p></li>
<li><p>HMAC as Message Authentication Code algorithm.</p></li>
</ul>
</div></blockquote>
<p>Applications can also support TLS PSK <a class="reference internal" href="#rfc4279" id="id9"><span>[RFC4279]</span></a> cipher suites, such as
<code class="docutils literal notranslate"><span class="pre">TLS_PSK_WITH_AES_128_CCM</span></code> <a class="reference internal" href="#rfc7925" id="id10"><span>[RFC7925]</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Implementation note</strong></p>
<p>Developers can replace default algorithms with others or implement more
algorithms according to actual usage scenarios and device capabilities.</p>
<p>If a Crypto hardware accelerator is integrated, the cipher suites and
algorithms also depend on those accelerator features.</p>
</div>
<p>More details of cipher suite are described below.</p>
<section id="digital-signature-and-verification">
<h4>Digital signature and verification<a class="headerlink" href="#digital-signature-and-verification" title="Permalink to this heading"></a></h4>
<p>ECDSA is selected by default in Profile Medium.
ECDSA requires much shorter keys compared with RSA at the same security level.
Therefore, ECDSA can cost less storage area for assets and less network
bandwidth to setup a TLS connection.
ECDSA is also preferred for forward compatibility of future TLS versions.</p>
<p>As requested in <a class="reference internal" href="#rfc7251" id="id11"><span>[RFC7251]</span></a>, ECC curve <code class="docutils literal notranslate"><span class="pre">secp256r1</span></code> should be supported. More
ECC curves can be added based on the requirements in production.</p>
<p>If usage scenarios require RSA algorithm for backward compatibility and legacy
applications, platforms can add RSA support or replace ECDSA with RSA. The
cipher suite should be switched accordingly.</p>
</section>
<section id="aead-algorithm">
<h4>AEAD algorithm<a class="headerlink" href="#aead-algorithm" title="Permalink to this heading"></a></h4>
<p>If Protected Storage (PS) is implemented, it is recommended to select the same
AEAD algorithm for PS service as the one used by TLS/DTLS cipher suite.</p>
</section>
</section>
<section id="internal-trusted-storage">
<h3>Internal Trusted Storage<a class="headerlink" href="#internal-trusted-storage" title="Permalink to this heading"></a></h3>
<p>The configuration of ITS is the same as those in Profile Small <a class="reference internal" href="#profile-s" id="id12"><span>[PROFILE-S]</span></a>.</p>
</section>
<section id="lightweight-boot">
<h3>Lightweight boot<a class="headerlink" href="#lightweight-boot" title="Permalink to this heading"></a></h3>
<p>BL2 implementation can be device specific. Devices may implement diverse
boot processes with different features and configurations.
However, the boot loader must support anti-rollback protection. Boot loader must
be able to prevent unauthorized rollback, to protect devices from being
downgraded to earlier versions with known vulnerabilities.</p>
<p>MCUBoot in TF-M is configured as multiple image boot by default in Profile
Medium. In multiple image boot, secure and non-secure images can be signed
independently with different keys and they can be updated separately. It can
support multiple vendors scenarios, in which non-secure and secure images are
generated and updated by different vendors.
Multiple image boot may require more storage area compared with single image
boot.</p>
</section>
<section id="protected-storage">
<h3>Protected Storage<a class="headerlink" href="#protected-storage" title="Permalink to this heading"></a></h3>
<p>PS service is required if an off-chip storage device is integrated and used on
the platform.</p>
<p>TF-M PS service relies on an AEAD algorithm to ensure data confidentiality and
integrity. It is recommended to select the same AEAD algorithm as the one used
for TLS/DTLS cipher suite.</p>
<p>Anti-rollback protection in PS relies on non-volatile counter(s) provided by
TF-M Platform Secure Partition (SP).</p>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading"></a></h2>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h3>
<p>The basic idea is to add dedicated profile CMake configuration files under
folder <code class="docutils literal notranslate"><span class="pre">config/profile</span></code> for TF-M Profile Medium default configuration, the
same as Profile Small does.</p>
<p>The top-level Profile Medium config file collects all the necessary
configuration flags and set them to default values, to explicitly enable the
features required in Profile Medium and disable the unnecessary ones, during
TF-M build.</p>
<p>A platform/use case can provide a configuration extension file to overwrite
Profile Medium default setting and append other configurations.
This configuration extension file can be added via parameter
<code class="docutils literal notranslate"><span class="pre">TFM_EXTRA_CONFIG_PATH</span></code> in build command line.</p>
<p>The behaviour of the Profile Medium build flow (particularly the order of
configuration loading and overriding) can be found at
<a class="reference internal" href="../build_configuration.html#tfm-cmake-configuration"><span class="std std-ref">Build configuration</span></a></p>
<p>The details of configurations will be covered in each module in
<a class="reference internal" href="#implementation-details">Implementation details</a>.</p>
</section>
<section id="implementation-details">
<h3>Implementation details<a class="headerlink" href="#implementation-details" title="Permalink to this heading"></a></h3>
<p>This section discusses the details of Profile Medium implementation.</p>
<section id="top-level-configuration-files">
<h4>Top-level configuration files<a class="headerlink" href="#top-level-configuration-files" title="Permalink to this heading"></a></h4>
<p>The firmware framework configurations in <code class="docutils literal notranslate"><span class="pre">config/profile/profile_medium</span></code> are
shown below.</p>
<table class="colwidths-auto docutils align-center" id="id19">
<caption><span class="caption-number">Table 31: </span><span class="caption-text">Config flags in Profile Medium top-level CMake config file</span><a class="headerlink" href="#id19" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Configs</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Descriptions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_ISOLATION_LEVEL</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>Select level 2 isolation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_PARTITION_INTERNAL_TRUSTED_STORAGE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable ITS SP</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ITS_BUF_SIZE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">32</span></code></p></td>
<td><p>ITS internal transient buffer size</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_PARTITION_CRYPTO</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable Crypto service</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CRYPTO_ASYM_ENCRYPT_MODULE_ENABLED</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Enable Crypto asymmetric
encryption operations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_MBEDCRYPTO_CONFIG_PATH</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${CMAKE_SOURCE_DIR}/lib/ext/mbedcrypto/mbedcrypto_config/tfm_mbedcrypto_config_profile_medium.h</span></code></p></td>
<td><p>Mbed Crypto config file path</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_MBEDCRYPTO_PSA_CRYPTO_CONFIG_PATH</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">${CMAKE_SOURCE_DIR}/lib/ext/mbedcrypto/mbedcrypto_config/crypto_config_profile_medium.h</span></code></p></td>
<td><p>Mbed Crypto PSA config file path</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_PARTITION_INITIAL_ATTESTATION</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable Initial Attestation service</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_PARTITION_PROTECTED_STORAGE</span></code> <a class="footnote-reference brackets" href="#id14" id="id13">1</a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable PS service</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_PARTITION_PLATFORM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable TF-M Platform SP</p></td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id13">1</a></span></dt>
<dd><p>PS service is enabled by default. Platforms without off-chip storage
devices can turn off <code class="docutils literal notranslate"><span class="pre">TFM_PARTITION_PROTECTED_STORAGE</span></code> to disable PS
service. See <a class="reference internal" href="#protected-storage-secure-partition">Protected Storage Secure Partition</a> for details.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Where a configuration is the same as the default in
<code class="docutils literal notranslate"><span class="pre">config/config_base.cmake</span></code>, it is omitted from the profile configuration
file.</p>
</div>
<section id="test-configuration">
<h5>Test configuration<a class="headerlink" href="#test-configuration" title="Permalink to this heading"></a></h5>
<p>Standard regression test configuration applies. This means that enabling
regression testing via</p>
<p><code class="docutils literal notranslate"><span class="pre">-DTEST_S=ON</span> <span class="pre">-DTEST_NS=ON</span></code></p>
<p>Will enable testing for all enabled partitions. See above for details of enabled
partitions. Because Profile Medium enables IPC model, the IPC tests are also
enabled.</p>
<p>Some cryptography tests are disabled due to the reduced Mbed Crypto config.</p>
<table class="colwidths-auto docutils align-center" id="id20">
<caption><span class="caption-number">Table 32: </span><span class="caption-text">TFM options in Profile Medium top-level CMake config file</span><a class="headerlink" href="#id20" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Configs</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Descriptions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_CBC</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable CBC mode test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_CCM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable CCM mode test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_CFB</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable CFB mode test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_ECB</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable ECB mode test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_CTR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable CTR mode test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_OFB</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable OFB mode test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_GCM</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable GCM mode test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_SHA_384</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable SHA-384 algorithm test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ALG_SHA_512</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable SHA-512 algorithm test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_HKDF</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable HKDF algorithm test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_ECDH</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ON</span></code></p></td>
<td><p>Enable ECDH key agreement test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_CHACHA20</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable ChaCha20 stream cipher test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_CHACHA20_POLY1305</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Disable ChaCha20-Poly1305 AEAD algorithm test</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TFM_CRYPTO_TEST_SINGLE_PART_FUNCS</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">OFF</span></code></p></td>
<td><p>Test single-part operations in hash, MAC,
AEAD and symmetric ciphers</p></td>
</tr>
</tbody>
</table>
</section>
<section id="device-configuration-extension">
<h5>Device configuration extension<a class="headerlink" href="#device-configuration-extension" title="Permalink to this heading"></a></h5>
<p>To change default configurations and add platform specific configurations,
a platform can add a platform configuration file at
<code class="docutils literal notranslate"><span class="pre">platform/ext&lt;TFM_PLATFORM&gt;/config.cmake</span></code></p>
</section>
</section>
<section id="crypto-service-configurations">
<h4>Crypto service configurations<a class="headerlink" href="#crypto-service-configurations" title="Permalink to this heading"></a></h4>
<section id="crypto-secure-partition">
<h5>Crypto Secure Partition<a class="headerlink" href="#crypto-secure-partition" title="Permalink to this heading"></a></h5>
<p>TF-M Profile Medium enables Crypto SP in top-level CMake config file.
The following PSA Crypto operationts are enabled by default.</p>
<blockquote>
<div><ul class="simple">
<li><p>Hash operations</p></li>
<li><p>Message authentication codes</p></li>
<li><p>Symmetric ciphers</p></li>
<li><p>AEAD operations</p></li>
<li><p>Asymmetric key algorithm based signature and verification</p></li>
<li><p>Key derivation</p></li>
<li><p>Key management</p></li>
</ul>
</div></blockquote>
</section>
<section id="mbed-crypto-configurations">
<h5>Mbed Crypto configurations<a class="headerlink" href="#mbed-crypto-configurations" title="Permalink to this heading"></a></h5>
<p>TF-M Profile Medium adds a dedicated Mbed Crypto config file
<code class="docutils literal notranslate"><span class="pre">tfm_mbedcrypto_config_profile_medium.h</span></code> and Mbed Crypto PSA config file
<code class="docutils literal notranslate"><span class="pre">crypto_config_profile_medium.h</span></code> at <code class="docutils literal notranslate"><span class="pre">/lib/ext/mbedcrypto/mbedcrypto_config</span></code>
folder, instead of the common one <code class="docutils literal notranslate"><span class="pre">tfm_mbedcrypto_config_default.h</span></code> and
<code class="docutils literal notranslate"><span class="pre">crypto_config_default.h</span></code> <a class="reference internal" href="#crypto-design" id="id15"><span>[CRYPTO-DESIGN]</span></a>.</p>
<p>Major Mbed Crypto configurations are set as listed below:</p>
<blockquote>
<div><ul class="simple">
<li><p>Enable SHA256</p></li>
<li><p>Enable generic message digest wrappers</p></li>
<li><p>Enable AES</p></li>
<li><p>Enable CCM mode for symmetric ciphers</p></li>
<li><p>Disable other modes for symmetric ciphers</p></li>
<li><p>Enable ECDH</p></li>
<li><p>Enable ECDSA</p></li>
<li><p>Select ECC curve <code class="docutils literal notranslate"><span class="pre">secp256r1</span></code></p></li>
<li><p>Other configurations required by selected option above</p></li>
</ul>
</div></blockquote>
<p>Other configurations can be selected to optimize the memory footprint of Crypto
module.</p>
<p>A device/use case can append an extra config header to the  Profile Medium
default Mbed Crypto config file. This can be done by setting the
<code class="docutils literal notranslate"><span class="pre">TFM_MBEDCRYPTO_PLATFORM_EXTRA_CONFIG_PATH</span></code> cmake variable in the platform
config file <code class="docutils literal notranslate"><span class="pre">platform/ext&lt;TFM_PLATFORM&gt;/config.cmake</span></code>. This cmake variable is
a wrapper around the <code class="docutils literal notranslate"><span class="pre">MBEDTLS_USER_CONFIG_FILE</span></code> options, but is preferred as
it keeps all configuration in cmake.</p>
</section>
</section>
<section id="internal-trusted-storage-configurations">
<h4>Internal Trusted Storage configurations<a class="headerlink" href="#internal-trusted-storage-configurations" title="Permalink to this heading"></a></h4>
<p>ITS service is enabled in top-level Profile Medium CMake config file by default.</p>
<p>The internal transient buffer size <code class="docutils literal notranslate"><span class="pre">ITS_BUF_SIZE</span></code> <a class="reference internal" href="#its-integrate" id="id16"><span>[ITS-INTEGRATE]</span></a> is set to
32 bytes by default. A platform/use case can overwrite the buffer size in its
specific configuration extension according to its actual requirement of assets
and Flash attributes.</p>
<p>Profile Medium CMake config file won’t touch the configurations of device
specific Flash hardware attributes <a class="reference internal" href="#its-integrate" id="id17"><span>[ITS-INTEGRATE]</span></a>.</p>
</section>
<section id="protected-storage-secure-partition">
<h4>Protected Storage Secure Partition<a class="headerlink" href="#protected-storage-secure-partition" title="Permalink to this heading"></a></h4>
<p>Data confidentiality, integrity and anti-rollback protection are enabled by
default in PS.</p>
<p>If PS is selected, AES-CCM is used as AEAD algorithm by default. It requires to
enable PS implementation to select diverse AEAD algorithm.</p>
<p>If platforms don’t integrate any off-chip storage device, platforms can disable
PS in platform specific configuration extension file via
<code class="docutils literal notranslate"><span class="pre">platform/ext&lt;TFM_PLATFORM&gt;/config.cmake</span></code>.</p>
</section>
<section id="bl2-setting">
<h4>BL2 setting<a class="headerlink" href="#bl2-setting" title="Permalink to this heading"></a></h4>
<p>Profile Medium enables MCUBoot provided by TF-M by default. A platform can
overwrite this configuration by disabling MCUBoot in its configuration extension
file <code class="docutils literal notranslate"><span class="pre">platform/ext&lt;TFM_PLATFORM&gt;/config.cmake</span></code>.</p>
<p>If MCUBoot provided by TF-M is enabled, multiple image boot is selected by
default in TF-M Profile Medium top-level CMake config file.</p>
<p>If a device implements its own boot loader, the configurations are
implementation defined.</p>
</section>
</section>
</section>
<section id="platform-support">
<h2>Platform support<a class="headerlink" href="#platform-support" title="Permalink to this heading"></a></h2>
<p>To enable Profile Medium on a platform, the platform specific CMake file should
be added into the platform support list in top-level Profile Medium CMake config
file.</p>
<section id="building-profile-medium">
<h3>Building Profile Medium<a class="headerlink" href="#building-profile-medium" title="Permalink to this heading"></a></h3>
<p>To build Profile Medium, argument <code class="docutils literal notranslate"><span class="pre">TFM_PROFILE</span></code> in build command line should be
set to <code class="docutils literal notranslate"><span class="pre">profile_medium</span></code>.</p>
<p>Take AN521 as an example:</p>
<p>The following commands build Profile Medium without test cases on <strong>AN521</strong> with
build type <strong>MinSizeRel</strong>, built by <strong>Armclang</strong>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>&lt;TFM<span class="w"> </span>root<span class="w"> </span>dir&gt;
mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-DTFM_PLATFORM<span class="o">=</span>arm/mps2/an521<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DTFM_TOOLCHAIN_FILE<span class="o">=</span>../toolchain_ARMCLANG.cmake<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DTFM_PROFILE<span class="o">=</span>profile_medium<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>MinSizeRel<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>../
cmake<span class="w"> </span>--build<span class="w"> </span>./<span class="w"> </span>--<span class="w"> </span>install
</pre></div>
</div>
<p>The following commands build Profile Medium with regression test cases on
<strong>AN521</strong> with build type <strong>MinSizeRel</strong>, built by <strong>Armclang</strong>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>&lt;TFM<span class="w"> </span>root<span class="w"> </span>dir&gt;
mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-DTFM_PLATFORM<span class="o">=</span>arm/mps2/an521<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DTFM_TOOLCHAIN_FILE<span class="o">=</span>../toolchain_ARMCLANG.cmake<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DTFM_PROFILE<span class="o">=</span>profile_medium<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>MinSizeRel<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>-DTEST_S<span class="o">=</span>ON<span class="w"> </span>-DTEST_NS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>../
cmake<span class="w"> </span>--build<span class="w"> </span>./<span class="w"> </span>--<span class="w"> </span>install
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>For devices with more contrained memory and flash requirements, it is
possible to build with either only TEST_S enabled or only TEST_NS enabled.
This will decrease the size of the test images. Note that both test suites
must still be run to ensure correct operation.</p></li>
</ul>
</div>
<p>More details of building instructions and parameters can be found TF-M build
instruction guide <a class="reference internal" href="#tfm-build" id="id18"><span>[TFM-BUILD]</span></a>.</p>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this heading"></a></h2>
<dl class="citation">
<dt class="label" id="psa-ff-m"><span class="brackets">PSA-FF-M</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>,<a href="#id5">3</a>)</span></dt>
<dd><p><a class="reference external" href="https://developer.arm.com/-/media/Files/pdf/PlatformSecurityArchitecture/Architect/DEN0063-PSA_Firmware_Framework-1.0.0-2.pdf?revision=2d1429fa-4b5b-461a-a60e-4ef3d8f7f4b4">Arm Platform Security Architecture Firmware Framework 1.0</a></p>
</dd>
<dt class="label" id="rfc7925"><span class="brackets">RFC7925</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id7">2</a>,<a href="#id8">3</a>,<a href="#id10">4</a>)</span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc7925">Transport Layer Security (TLS) / Datagram Transport Layer Security (DTLS) Profiles for the Internet of Things</a></p>
</dd>
<dt class="label" id="profile-s"><span class="brackets"><a class="fn-backref" href="#id12">PROFILE-S</a></span></dt>
<dd><p><a class="reference internal" href="tfm_profile_small.html"><span class="doc">Trusted Firmware-M Profile Small Design</span></a></p>
</dd>
<dt class="label" id="rfc7252"><span class="brackets">RFC7252</span><span class="fn-backref">(<a href="#id4">1</a>,<a href="#id6">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a></p>
</dd>
<dt class="label" id="rfc4279"><span class="brackets"><a class="fn-backref" href="#id9">RFC4279</a></span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc4279">Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)</a></p>
</dd>
<dt class="label" id="rfc7251"><span class="brackets"><a class="fn-backref" href="#id11">RFC7251</a></span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc7251">AES-CCM Elliptic Curve Cryptography (ECC) Cipher Suites for TLS</a></p>
</dd>
<dt class="label" id="crypto-design"><span class="brackets"><a class="fn-backref" href="#id15">CRYPTO-DESIGN</a></span></dt>
<dd><p><a class="reference internal" href="../../technical_references/design_docs/tfm_crypto_design.html"><span class="doc">Crypto design</span></a></p>
</dd>
<dt class="label" id="its-integrate"><span class="brackets">ITS-INTEGRATE</span><span class="fn-backref">(<a href="#id16">1</a>,<a href="#id17">2</a>)</span></dt>
<dd><p><a class="reference internal" href="../../integration_guide/services/tfm_its_integration_guide.html"><span class="doc">ITS integration guide</span></a></p>
</dd>
<dt class="label" id="tfm-build"><span class="brackets"><a class="fn-backref" href="#id18">TFM-BUILD</a></span></dt>
<dd><p><a class="reference internal" href="../../building/tfm_build_instruction.html"><span class="doc">TF-M build instruction</span></a></p>
</dd>
</dl>
<hr class="docutils" />
<p><em>Copyright (c) 2020-2022, Arm Limited. All rights reserved.</em></p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>